import{K as t,g as e,d as i,o as s,l as n,n as o,i as a,x as h,t as l}from"./vendor.e75a9f0e.js";import{A as c}from"./common.c8fc7f20.js";import"./libs.ec5fd20d.js";import"./components.a228e139.js";const r=new Map;var p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"template-control",class:{visible:t.visible,lock:t.lock},style:t.wrapperStyle,on:{pointerdown:function(e){return e.stopPropagation(),t.onPointerdown.apply(null,arguments)}}},[e("div",{staticClass:"template-control-mask"}),e("i",{staticClass:"template-control-point top-left",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("topLeft",e)}}}),e("i",{staticClass:"template-control-point top-center",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("topCenter",e)}}}),e("i",{staticClass:"template-control-point top-right",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("topRight",e)}}}),e("i",{staticClass:"template-control-point center-left",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("centerLeft",e)}}}),e("i",{staticClass:"template-control-point center-right",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("centerRight",e)}}}),e("i",{staticClass:"template-control-point bottom-left",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("bottomLeft",e)}}}),e("i",{staticClass:"template-control-point bottom-center",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("bottomCenter",e)}}}),e("i",{staticClass:"template-control-point bottom-right",on:{pointerdown:function(e){return e.stopPropagation(),t.onControlPointerdown("bottomRight",e)}}}),t._t("default")],2)},d=[];const f={topLeft(t){const e=this.$el.getBoundingClientRect();this.stashPosition={x:e.left,y:e.top}},topCenter(t){const e=this.$el.getBoundingClientRect();this.stashPosition={x:e.left,y:e.top}},topRight(t){const e=this.$el.getBoundingClientRect(),i=this.scale/100;this.stashPosition={x:this.$el.offsetWidth*i+e.left,y:e.top}},centerLeft(t){const e=this.$el.getBoundingClientRect();this.stashPosition={x:e.left,y:e.top}},centerRight(t){const e=this.$el.getBoundingClientRect(),i=this.scale/100;this.stashPosition={x:this.$el.offsetWidth*i+e.left,y:this.$el.offsetHeight/2*i+e.top}},bottomLeft(t){const e=this.$el.getBoundingClientRect(),i=this.scale/100;this.stashPosition={x:e.left,y:this.$el.offsetHeight*i+e.top}},bottomCenter(t){const e=this.$el.getBoundingClientRect(),i=this.scale/100;this.stashPosition={x:this.$el.offsetWidth/2*i+e.left,y:this.$el.offsetHeight*i+e.top}},bottomRight(t){const e=this.$el.getBoundingClientRect(),i=this.scale/100;this.stashPosition={x:this.$el.offsetWidth*i+e.left,y:this.$el.offsetHeight*i+e.top}}},u={topLeft(t){if(this.stashPosition){const e=this.scale/100,i=this.stageInstance.$el.getBoundingClientRect();let s=t.pageY-i.top-this.offset.h*e,n=t.pageX-i.left-this.offset.w*e;n<=0&&(n=0);let o=this.data.w+(this.data.x-n/e);o<=this.miniSize.w?o=this.miniSize.w:this.data.x=n/e,s<=0&&(s=0);let a=this.data.h+(this.data.y-s/e);a<=this.miniSize.h?a=this.miniSize.h:this.data.y=s/e,this.data.h=a,this.data.w=o}},topCenter(t){if(this.stashPosition){const e=this.scale/100,i=this.stageInstance.$el.getBoundingClientRect();let s=t.pageY-i.top-this.offset.h*e;s<=0&&(s=0);let n=this.data.h+(this.data.y-s/e);n<=this.miniSize.h?n=this.miniSize.h:this.data.y=s/e,this.data.h=n}},topRight(t){if(this.stashPosition){const e=this.scale/100,i=this.stageInstance.$el.getBoundingClientRect();let s=this.initSize.w*e+(t.pageX-this.stashPosition.x);s<=this.miniSize.w*e&&(s=this.miniSize.w*e),this.$el.offsetLeft*e+s>=this.stageInstance.$el.clientWidth*e&&(s=(this.stageInstance.$el.clientWidth-this.$el.offsetLeft)*e),this.data.w=s/e;let n=t.pageY-i.top-this.offset.h*e;n<=0&&(n=0);let o=this.data.h+(this.data.y-n/e);o<=this.miniSize.h?o=this.miniSize.h:this.data.y=n/e,this.data.h=o}},centerLeft(t){if(this.stashPosition){const e=this.scale/100,i=this.stageInstance.$el.getBoundingClientRect();let s=t.pageX-i.left-this.offset.w*e;s<=0&&(s=0);let n=this.data.w+(this.data.x-s/e);n<=this.miniSize.w?n=this.miniSize.w:this.data.x=s/e,this.data.w=n}},centerRight(t){if(this.stashPosition){const e=this.scale/100;let i=this.initSize.w*e+(t.pageX-this.stashPosition.x);i<=this.miniSize.w*e&&(i=this.miniSize.w*e),this.$el.offsetLeft*e+i>=this.stageInstance.$el.clientWidth*e&&(i=(this.stageInstance.$el.clientWidth-this.$el.offsetLeft)*e),this.data.w=i/e}},bottomLeft(t){if(this.stashPosition){const e=this.scale/100,i=this.stageInstance.$el.getBoundingClientRect();let s=t.pageX-i.left-this.offset.w*e,n=this.initSize.h*e+(t.pageY-this.stashPosition.y);n<=this.miniSize.h*e&&(n=this.miniSize.h*e),this.$el.offsetTop*e+n>=this.stageInstance.$el.clientHeight*e&&(n=this.stageInstance.$el.clientHeight*e-this.$el.offsetTop*e),this.data.h=n/e,s<=0&&(s=0);let o=this.data.w+(this.data.x-s/e);o<=this.miniSize.w?o=this.miniSize.w:this.data.x=s/e,this.data.w=o}},bottomCenter(t){if(this.stashPosition){const e=this.scale/100;let i=this.initSize.h*e+(t.pageY-this.stashPosition.y);i<=this.miniSize.h*e&&(i=this.miniSize.h*e),this.$el.offsetTop*e+i>=this.stageInstance.$el.clientHeight*e&&(i=this.stageInstance.$el.clientHeight*e-this.$el.offsetTop*e),this.data.h=i/e}},bottomRight(t){const e=this.scale/100;let i=this.initSize.w*e+(t.pageX-this.stashPosition.x),s=this.initSize.h*e+(t.pageY-this.stashPosition.y);i<=this.miniSize.w*e&&(i=this.miniSize.w*e),s<=this.miniSize.h*e&&(s=this.miniSize.h*e),this.$el.offsetLeft*e+i>=this.stageInstance.$el.clientWidth*e&&(i=(this.stageInstance.$el.clientWidth-this.$el.offsetLeft)*e),this.$el.offsetTop*e+s>=this.stageInstance.$el.clientHeight*e&&(s=(this.stageInstance.$el.clientHeight-this.$el.offsetTop)*e),this.data.w=i/e,this.data.h=s/e}};const g=o({name:"TemplateControl",inject:["stageInstance"],props:{zIndex:{type:Number,required:!0},scale:{type:Number,default:1},position:{type:Object,required:!0},size:{type:Object,required:!0},value:{type:Boolean,required:!0},lock:{type:Boolean,required:!0}},setup(o,p){const d=e().proxy,f=a({get:()=>o.value,set(t){p.emit("input",t)}}),{multiple:g}=function(){const o=t("stageInstance"),a=e().proxy,h=i(!1),l=function(t){for(const[e,i]of r)a._uid!==e&&(h.value||(i.visible=!1))},c=function(t){t.shiftKey&&(h.value=!0)},p=function(t){h.value=!1};return s((function(){r.set(a._uid,a),a.$el.addEventListener("pointerdown",l),o.$el.addEventListener("keydown",c),o.$el.addEventListener("keyup",p)})),n((function(){r.delete(a._uid),a.$el.removeEventListener("pointerdown",l),o.$el.removeEventListener("keydown",c),o.$el.removeEventListener("keyup",p)})),{multiple:h}}(),m=i(null),w=h({x:o.position.x,y:o.position.y,h:o.size.h,w:o.size.w}),$=i(null),y=h({w:0,h:0}),v=h({w:0,h:0}),x=function(t){const e={w:0,h:0};return s((function(){const[i,s]=c(t.$el);e.w=i,e.h=s})),e}(d.stageInstance),z=function(t){if(!o.lock&&$.value){const e=o.scale/100;if(m.value)return u[m.value].call(d,t),p.emit("update:position",{x:w.x,y:w.y}),void p.emit("update:size",{w:w.w,h:w.h});let i=t.pageX-$.value.x,s=t.pageY-$.value.y;i<=0&&(i=0),s<=0&&(s=0),i>(d.stageInstance.$el.clientWidth-y.w)*e&&(i=(d.stageInstance.$el.clientWidth-y.w)*e),s>(d.stageInstance.$el.clientHeight-y.h)*e&&(s=(d.stageInstance.$el.clientHeight-y.h)*e),w.x=i/e,w.y=s/e,p.emit("update:position",{x:w.x,y:w.y}),p.emit("move",{x:w.x,y:w.y})}},P=function(t){$.value&&($.value=null,m.value=null,y.w=w.w,y.h=w.h,p.emit("moveEnd"),p.emit("resizeEnd"))},C=function(t){f.value=!1};return s((function(){l((function(){w.w=y.w=v.w=d.$el.offsetWidth,w.h=y.h=v.h=d.$el.offsetHeight,p.emit("update:size",{w:w.w,h:w.h})})),window.addEventListener("pointerdown",C),d.stageInstance.$el.addEventListener("pointermove",z),d.stageInstance.$el.addEventListener("pointerup",P)})),n((function(){window.removeEventListener("pointerdown",C),d.stageInstance.$el.removeEventListener("pointermove",z),d.stageInstance.$el.removeEventListener("pointerup",P)})),{offset:x,visible:f,multiple:g,pointType:m,initSize:y,miniSize:v,data:w,stashPosition:$,onPointerdown:function(t){const e=o.scale/100;f.value=!0,m.value=null,$.value={x:t.pageX-d.$el.offsetLeft*e,y:t.pageY-d.$el.offsetTop*e},p.emit("select",d),p.emit("moveStart",{x:w.x,y:w.y})}}},computed:{wrapperStyle(){return{zIndex:this.zIndex,left:this.data.x+"px",top:this.data.y+"px",width:this.data.w?this.data.w+"px":"auto",height:this.data.h?this.data.h+"px":"auto"}}},methods:{onControlPointerdown(t,e){this.pointType=t,f[t].apply(this,[e]),this.$emit("resizeStart",{w:this.data.w,h:this.data.h})}},watch:{value(t){this.visible=t},position:{deep:!0,handler(t){this.data.x=t.x,this.data.y=t.y}},size:{deep:!0,handler(t){this.data.w=t.w,this.data.h=t.h}}}},p,d,!1,null,null,null,null).exports;export{g as default};
//# sourceMappingURL=template-control.fa560f86.js.map
