import{n as e,g as t,K as s,d as n,x as a,o,J as i,l as r,t as c}from"./vendor.e75a9f0e.js";import{s as l,t as p,A as g}from"./common.c8fc7f20.js";import"./libs.ec5fd20d.js";import"./components.a228e139.js";var h=function(){var e=this,t=e._self._c;return t("svg",{staticClass:"template-area",style:{left:e.rectStyle.left,top:e.rectStyle.top},attrs:{xmlns:"http://www.w3.org/2000/svg",width:e.rectStyle.width,height:e.rectStyle.height}},[t("rect",{attrs:{stroke:"var(--color-primary)",fill:"rgba(0, 0, 0, 0.1)","stroke-width":"1",height:"100%",width:"100%"}})])},f=[];const u=e({name:"TemplateArea",inject:["stageInstance"],props:{scale:{type:Number,required:!0}},setup(e,g){const h=t().proxy,f=s(l),u=n(null),d=a({w:0,h:0,x:0,y:0}),m=new Map,y=function(t){if(h.stageInstance.spaceDown)return;const s=e.scale/100,n=(t.pageX-h.stageRect.x)/s-h.offset.x,a=(t.pageY-h.stageRect.y)/s-h.offset.y;d.x=n,d.y=a,u.value={x:t.pageX,y:t.pageY}},v=function(t){if(u.value){const s=e.scale/100,n=(t.pageX-u.value.x)/s,a=(t.pageY-u.value.y)/s;d.w=n,d.h=a;for(const[,e]of f.components)e.props.position.x>=d.x&&e.props.position.x<=d.x+d.w&&e.props.position.y>=d.y&&e.props.position.y<=d.y+d.h&&(m.has(e.uid)||m.set(e.uid,e))}},x=function(e){if(u.value=null,d.w=d.h=d.x=d.y=0,m.size){const e=Array.from(m.values());return g.emit("area",e),void m.clear()}g.emit("unArea")},w=function(e){c((function(){h.updateOffset(),h.updateRect()}))};return o((function(){i.$on(p.stageMove,w),i.$on(p.stagePaddingChange,w),i.$on(p.stageSizeChange,w),i.$on(p.stageScaleChange,w),i.$emit(p.stageSizeChange),h.stageInstance.$el.addEventListener("pointerdown",y),h.stageInstance.$el.addEventListener("pointermove",v),h.stageInstance.$el.addEventListener("pointerup",x)})),r((function(){i.$off(p.stageMove,w),i.$off(p.stagePaddingChange,w),i.$off(p.stageSizeChange,w),i.$off(p.stageScaleChange,w),h.stageInstance.$el.removeEventListener("pointerdown",y),h.stageInstance.$el.removeEventListener("pointermove",v),h.stageInstance.$el.removeEventListener("pointerup",x)})),{rect:d,stagePosition:u}},data:()=>({stageRect:{x:0,y:0,w:0,h:0},offset:{x:0,y:0}}),computed:{rectStyle(){return{width:this.rect.w>=0?this.rect.w:0,height:this.rect.h>=0?this.rect.h:0,left:this.rect.x+"px",top:this.rect.y+"px"}}},methods:{updateOffset(){if(this.stageInstance.$el){const[e,t]=g(this.stageInstance.$el);this.offset={x:e,y:t}}else this.offset={x:0,y:0}},updateRect(){if(this.stageInstance.$el){const e=this.stageInstance.$el.getBoundingClientRect();this.stageRect={x:e.left,y:e.top,w:e.width,h:e.width}}else this.stageRect={x:0,y:0,w:0,h:0}}}},h,f,!1,null,null,null,null).exports;export{u as default};
//# sourceMappingURL=template-area.1e70fa1a.js.map
