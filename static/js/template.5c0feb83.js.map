{"version":3,"mappings":"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","names":["undoGeneral","record","this","restore","push","cloneDeep","length","recordComponent","component","components","has","uid","id","createId","set","componentsData","Array","from","values","console","log","restoreGeneral","recordActionHandle","componentAdd","undo","eventBus","$emit","templateChannel","componentDel","TemplateEvent","detail","target","componentGeneral","apply","recordHandle","action","type","recordData","data","Object","create","createRecord","group","info","recordTypeMap","props","moment","format","groupEnd","initBuiltinComponent","namespace","forEach","item","index","basicBuiltinComponent","label","createBuiltinComponent","createBuiltinComponentGroup","builtin","position","usePosition","resultsAnalysisBuiltinComponent","otherBuiltinComponent","customBuiltinComponent","size","useSize","w","h","name","builtinComponent","Map","prototype","concat","map","builtinComponents","setup","items","builtinComponentMap","reactive","used","offset","x","y","stageClear","e","value","get","shapeId","onMounted","$on","onBeforeUnmount","$off","useBuiltinComponent","methods","dragHandle","dragstartHandle","rect","getBoundingClientRect","pageX","left","pageY","top","dataTransfer","dropEffect","effectAllowed","setData","JSON","stringify","dragendHandle","clearData","vm","getCurrentInstance","proxy","store","inject","storeSymbol","form","direction","padding","usePadding","state","dialog","actionType","options","readonly","open","close","submit","visible","editor","_a","useDialog","nextTick","$refs","templateName","focus","goBack","$router","go","event","stageUndo","stageRestore","isNearly","dragValue","targetValue","Math","abs","conditions","yl","rect1","rect2","ll","lr","right","yc","width","yr","rr","rl","xt","tt","tb","bottom","xc","height","xb","bb","bt","TemplateStage","BuiltinInput","__vitePreload","import","BuiltinGroup","BuiltinSelect","TemplateControl","TemplateMarkLine","TemplateArea","TemplateContextmenu","scale","Number","required","spaceDown","Boolean","scaleManual","provide","stageInstance","markLine","ref","moveHandle","currentComponent","currentRect","getRect","key","condition","line","moveEndHandle","componentMove","componentMoveEnd","useMarkLine","computed","stageStyle","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","transformOrigin","transform","dropHandle","response","getData","parse","shapeLocation","el","$el","selectComponent","componentSelect","unSelectComponent","children","componentSelectUn","groupUn","deleteComponent","moveStart","componentMoveStart","move","moveEnd","resizeStart","componentResizeStart","resize","componentResize","resizeEnd","componentResizeEnd","area","groupPack","toHtml","builtinGroupComponentRef","isArray","builtinComponentRef","root","cloneNode","fragment","document","createDocumentFragment","style","window","getComputedStyle","border","boxShadow","backgroundImage","backgroundRepeat","filter","append","appendChild","watch","val","stageScaleChange","handler","stageMove","deep","dispatchEvent","Event","stageSizeChange","stagePaddingChange","editorInstance","stashPosition","refComponent","node","margin","html","outerHTML","blob","Blob","url","URL","createObjectURL","editorToHtml","useToHtml","step","max","mini","manual","mousewheel","deltaY","leftScale","clientX","topScale","clientY","newRectLeft","newRectTop","addEventListener","removeEventListener","mounted","context","stage","init","pointerdown","button","offsetLeft","offsetTop","pointermove","pointerup","$once","canvas","offsetWidth","offsetHeight","spaceDownHandle","cursor","spaceUpHandle","builtinComponentName","builtinComponentPropertySetting","builtinComponentName_input","setting","builtinComponentName_select","option","TemplatePropertyOption","fonts","useFont","fontSizes","useFontSize","property","result","useSetting","current","componentSizeChange","componentFontChange","componentFontSizeChange","print","save","beforeRouteEnter","to","next","indexOf","query","path","replace","TemplateAside","TemplateToolbar","TemplateEditor","TemplateProperty","String","useStore","componentChange","recordChannel","useRecord","addComponent","changes","delComponent","delete","moveComponentStart","moveComponent","moveComponentEnd","resizeComponentStart","resizeComponent","resizeComponentEnd","clear","groupComponent","removeGroupComponent","popRecord","pop","onUnmounted"],"sources":["../../../src/views/template/utils/record.js","../../../src/views/template/hooks/useRecord.js","../../../src/views/template/components/builtin/index.js","../../../src/views/template/hooks/useBuiltin.js","../../../src/views/template/action/template-aside.vue","../../../src/views/template/action/template-toolbar.vue","../../../src/hooks/useDialog.js","../../../src/views/template/hooks/useMarkLine.js","../../../src/views/template/action/template-editor.vue","../../../src/views/template/action/template-stage.vue","../../../src/views/template/hooks/useToHtml.js","../../../src/views/template/hooks/useSetting.js","../../../src/views/template/action/template-property.vue","../../../src/views/template/action/index.vue?chunkName=template"],"sourcesContent":["import { cloneDeep } from 'lodash-es'\nimport { TemplateEvent, createId } from '.'\nimport { templateChannel } from '@/views/template/constant'\nimport eventBus from '@/utils/eventBus'\n\n/**\n * @param {Template.BuiltinComponentRecordType} type\n * @param {Template.BuiltinComponent} component\n */\nexport function createRecord(type, component) {\n  /**\n   * @type {Template.BuiltinComponentRecord}\n   */\n  const data = Object.create(null)\n  data.type = type\n  data.component = cloneDeep(component)\n\n  return data\n}\n\n/**\n * @this {Template.Store}\n * @param {Template.BuiltinComponent} record\n */\nfunction undoGeneral(record) {\n  this.restore.push(cloneDeep(record))\n\n  if (this.record.length) {\n    const recordComponent = this.record[this.record.length - 1].component\n\n    if (this.components.has(recordComponent.uid)) {\n      /**\n       * @type {Template.BuiltinComponent}\n       */\n      const component = cloneDeep(recordComponent)\n      component.id = createId(recordComponent.uid)\n\n      this.components.set(component.uid, component)\n      this.componentsData = Array.from(this.components.values())\n      console.log('撤销更改', 'uid', component.uid, '新id', component.id, '旧id', recordComponent.id)\n    }\n  }\n}\n\n/**\n * @this {Template.Store}\n * @param {Template.BuiltinComponentRecord} record\n */\nfunction restoreGeneral(record) {\n  const recordComponent = record.component\n\n  if (this.components.has(recordComponent.uid)) {\n    /**\n     * @type {Template.BuiltinComponent}\n     */\n    const component = cloneDeep(recordComponent)\n    component.id = createId(recordComponent.uid)\n\n    this.components.set(component.uid, component)\n    this.componentsData = Array.from(this.components.values())\n    console.log('恢复更改', 'uid', component.uid, '新id', component.id, '旧id', recordComponent.id)\n  }\n}\n\nconst recordActionHandle = {\n  componentAdd: {\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    undo(record) {\n      this.restore.push(record)\n\n      eventBus.$emit(\n        templateChannel.componentDel,\n        new TemplateEvent(templateChannel.componentDel, {\n          detail: record.component,\n          target: 'stage'\n        }),\n        false\n      )\n    },\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    restore(record) {\n      eventBus.$emit(\n        templateChannel.componentAdd,\n        new TemplateEvent(templateChannel.componentAdd, {\n          detail: record.component,\n          target: 'stage'\n        }),\n        false\n      )\n    }\n  },\n  componentDel: {\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    undo(record) {\n      this.restore.push(record)\n\n      eventBus.$emit(\n        templateChannel.componentAdd,\n        new TemplateEvent(templateChannel.componentAdd, {\n          detail: record.component,\n          target: 'stage'\n        }),\n        false\n      )\n    },\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    restore(record) {\n      eventBus.$emit(\n        templateChannel.componentDel,\n        new TemplateEvent(templateChannel.componentDel, {\n          detail: record.component,\n          target: 'stage'\n        }),\n        false\n      )\n    }\n  },\n  componentGeneral: {\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    undo(record) {\n      undoGeneral.apply(this, [record])\n    },\n    /**\n     * @this {Template.Store}\n     * @param {Template.BuiltinComponentRecord} record\n     */\n    restore(record) {\n      restoreGeneral.apply(this, [record])\n    }\n  }\n}\n\n/**\n * @this {Template.Store}\n * @param {'undo'|'restore'} action\n * @param {Template.BuiltinComponentRecord} record\n */\nexport function recordHandle(action, record) {\n  switch (record.type) {\n    case 'component:add':\n      recordActionHandle.componentAdd[action].apply(this, [record])\n      break\n    case 'component:del':\n      recordActionHandle.componentDel[action].apply(this, [record])\n      break\n    case 'component:move:end':\n    case 'component:resize:end':\n    case 'component:font:change':\n      recordActionHandle.componentGeneral[action].apply(this, [record])\n      break\n  }\n}\n","import moment from 'moment'\nimport { onBeforeUnmount, onMounted } from 'vue'\nimport { recordChannel, recordTypeMap } from '@/views/template/constant'\nimport { createRecord } from '@/views/template/utils/record'\nimport eventBus from '@/utils/eventBus'\n\n/**\n * @this {Template.Store}\n * @param {Template.BuiltinComponentRecordType} type\n * @param {Template.BuiltinComponent} component\n * @param {boolean} [record] 是否记录\n */\nfunction recordHandle(type, component = null, record = true) {\n  if (component) {\n    const recordData = createRecord(type, component)\n\n    console.group('record')\n    console.info('事件', recordTypeMap[type])\n    console.info('组件id', component.id)\n    console.info('组件uid', component.uid)\n    console.info('组件props', component.props)\n    console.info('时间戳', moment().format('yyyy-MM-DD HH:mm:ss'))\n    console.groupEnd()\n\n    if (record && this.record.length <= 20) {\n      this.record.push(recordData)\n    }\n\n    return\n  }\n\n  console.group('record')\n  console.info('事件', recordTypeMap[type])\n  console.info('时间戳', moment().format('yyyy-MM-DD HH:mm:ss'))\n  console.groupEnd()\n}\n\n/**\n * @param {Template.Store} store\n */\nexport function useRecord(store) {\n  let move = false\n  let resize = false\n\n  /**\n   * @param {Template.Event<Template.BuiltinComponent | null>} e\n   */\n  const componentChange = function (e) {\n    switch (e.type) {\n      case 'component:add':\n      case 'component:del':\n      case 'component:font:change':\n        recordHandle.apply(store, [e.type, e.detail])\n        break\n      case 'component:resize:start':\n        resize = true\n        break\n      case 'component:resize':\n        recordHandle.apply(store, [e.type, e.detail, false])\n        break\n      case 'component:resize:end':\n        if (e.target === 'property') {\n          recordHandle.apply(store, [e.type, e.detail])\n        } else if (resize) {\n          resize = false\n          recordHandle.apply(store, [e.type, e.detail])\n        }\n        break\n      case 'component:move:start':\n        recordHandle.apply(store, [e.type, e.detail, false])\n        break\n      case 'component:move':\n        move = true\n        break\n      case 'component:move:end':\n        if (e.target === 'property') {\n          recordHandle.apply(store, [e.type, e.detail])\n        } else if (move) {\n          move = false\n          recordHandle.apply(store, [e.type, e.detail])\n        }\n    }\n  }\n\n  onMounted(function () {\n    eventBus.$on(recordChannel.componentAdd, componentChange)\n    eventBus.$on(recordChannel.componentDel, componentChange)\n    eventBus.$on(recordChannel.componentMoveStart, componentChange)\n    eventBus.$on(recordChannel.componentMove, componentChange)\n    eventBus.$on(recordChannel.componentMoveEnd, componentChange)\n    eventBus.$on(recordChannel.componentFontChange, componentChange)\n    eventBus.$on(recordChannel.componentResizeStart, componentChange)\n    eventBus.$on(recordChannel.componentResize, componentChange)\n    eventBus.$on(recordChannel.componentResizeEnd, componentChange)\n  })\n\n  onBeforeUnmount(function () {\n    eventBus.$off(recordChannel.componentAdd, componentChange)\n    eventBus.$off(recordChannel.componentDel, componentChange)\n    eventBus.$off(recordChannel.componentMoveStart, componentChange)\n    eventBus.$off(recordChannel.componentMove, componentChange)\n    eventBus.$off(recordChannel.componentMoveEnd, componentChange)\n    eventBus.$off(recordChannel.componentFontChange, componentChange)\n    eventBus.$off(recordChannel.componentSizeChange, componentChange)\n    eventBus.$off(recordChannel.componentResizeStart, componentChange)\n    eventBus.$off(recordChannel.componentResize, componentChange)\n    eventBus.$off(recordChannel.componentResizeEnd, componentChange)\n  })\n}\n","import { createBuiltinComponent, createBuiltinComponentGroup } from '@/views/template/utils'\nimport { usePosition, useSize } from '@/views/template/hooks/useProperty'\n\n/**\n * @param {string} namespace\n * @param {Template.Builtin[]} components\n */\nfunction initBuiltinComponent(namespace, components) {\n  components.forEach(function (item, index) {\n    item.id = namespace + '-' + index\n  })\n\n  return components\n}\n\n/**\n * @type {Template.Builtin[]}\n */\nexport const basicBuiltinComponent = initBuiltinComponent('basicBuiltinComponent', [\n  {\n    id: '',\n    label: '病例名称',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '产前编号',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '姓名',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '姓名组',\n    create() {\n      return createBuiltinComponentGroup(\n        { builtin: true, props: { label: this.label, position: usePosition(0, 20) } },\n        [\n          createBuiltinComponent({ props: { label: '姓名1' } }),\n          createBuiltinComponent({ props: { label: '姓名2', position: usePosition(20, 20) } })\n        ]\n      )\n    }\n  }\n])\n\n/**\n * @type {Template.Builtin[]}\n */\nexport const resultsAnalysisBuiltinComponent = initBuiltinComponent('resultsAnalysisBuiltinComponent', [\n  {\n    id: '',\n    label: '核型表达式',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '排列图',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '中期分裂图',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '所有细胞数',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '计数细胞数',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '排列细胞数',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  }\n])\n\n/**\n * @type {Template.Builtin[]}\n */\nexport const otherBuiltinComponent = initBuiltinComponent('otherBuiltinComponent', [\n  {\n    id: '',\n    label: '机构名称',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '样本类型',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '采集日期',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '接收日期',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '检查方法',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '报告日期',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '审核日期',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '接收医师',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '审核医师',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  }\n])\n\n/**\n * @type {Template.Builtin[]}\n */\nexport const customBuiltinComponent = initBuiltinComponent('customBuiltinComponent', [\n  {\n    id: '',\n    label: '输入框',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '下拉框',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '日期',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '电子签名',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '文本域',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '图片',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '矩形',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '矩形1',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label, size: useSize({ w: 120, h: 60 }) } })\n    }\n  },\n  {\n    id: '',\n    label: '矩形2',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label, size: useSize({ w: 60, h: 120 }) } })\n    }\n  },\n  {\n    id: '',\n    label: '横线',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '竖线',\n    create() {\n      return createBuiltinComponent({ props: { label: this.label } })\n    }\n  },\n  {\n    id: '',\n    label: '筛选项',\n    create() {\n      return createBuiltinComponent({ name: 'builtin-select', props: { label: this.label } })\n    }\n  }\n])\n\n/**\n * @type {Map<string, Template.Builtin>}\n */\nexport const builtinComponent = new Map(\n  Array.prototype.concat\n    .apply([], [basicBuiltinComponent, resultsAnalysisBuiltinComponent, otherBuiltinComponent, customBuiltinComponent])\n    .map(item => [item.id, item])\n)\n","import { reactive, onMounted, onBeforeUnmount } from 'vue'\nimport {\n  basicBuiltinComponent,\n  otherBuiltinComponent,\n  customBuiltinComponent\n} from '@/views/template/components/builtin'\nimport { templateChannel } from '@/views/template/constant'\nimport eventBus from '@/utils/eventBus'\n\nconst builtinComponents = [basicBuiltinComponent, otherBuiltinComponent, customBuiltinComponent]\n\nexport function useBuiltinComponent() {\n  /**\n   * @type {Array<{label: string, items: Template.BuiltinComponentItem[]}>}\n   */\n  const builtinComponent = [\n    { label: '基本控件', items: [] },\n    { label: '其他控件', items: [] },\n    { label: '自定义控件', items: [] }\n  ]\n\n  /**\n   * @type {Map<string, Template.BuiltinComponentItem>}\n   */\n  const builtinComponentMap = new Map()\n\n  builtinComponents.forEach((components, index) => {\n    for (const item of components) {\n      const data = reactive({\n        label: item.label,\n        id: item.id,\n        used: false,\n        offset: { x: 0, y: 0 }\n      })\n\n      builtinComponentMap.set(item.id, data)\n      builtinComponent[index].items.push(data)\n    }\n  })\n\n  /**\n   * @param {Template.Event} e\n   */\n  const stageClear = function (e) {\n    builtinComponent.forEach(function (value) {\n      value.items.forEach(function (item) {\n        item.used = false\n      })\n    })\n  }\n\n  /**\n   * @param {Template.Event<Template.BuiltinComponent>} e\n   */\n  const componentAdd = function (e) {\n    const item = builtinComponentMap.get(e.detail.shapeId)\n\n    if (item) {\n      item.used = true\n    }\n  }\n\n  /**\n   * @param {Template.Event<Template.BuiltinComponent>} e\n   */\n  const componentDel = function (e) {\n    const item = builtinComponentMap.get(e.detail.shapeId)\n\n    if (item) {\n      item.used = true\n    }\n  }\n\n  onMounted(function () {\n    eventBus.$on(templateChannel.componentAdd, componentAdd)\n    eventBus.$on(templateChannel.componentDel, componentDel)\n    eventBus.$on(templateChannel.stageClear, stageClear)\n  })\n\n  onBeforeUnmount(function () {\n    eventBus.$off(templateChannel.componentAdd, componentAdd)\n    eventBus.$off(templateChannel.componentDel, componentDel)\n    eventBus.$off(templateChannel.stageClear, stageClear)\n  })\n\n  return { builtinComponent }\n}\n","<template lang=\"pug\">\naside.template-aside\n  section.template-aside-container(v-for=\"(value, k) in builtinComponent\" :key=\"k\")\n    h1.template-aside-title {{ value.label }}：\n    ol.template-component-group\n      li.template-component-item(\n        v-for=\"item of value.items\"\n        :key=\"item.id\"\n        :class=\"{ used: item.used }\"\n        :draggable=\"!item.used\"\n        @dragstart=\"dragstartHandle($event, item)\"\n        @dragend=\"dragendHandle($event)\"\n        @drag=\"dragHandle($event)\") {{item.label}}\n</template>\n\n<script>\nimport { useBuiltinComponent } from '@/views/template/hooks/useBuiltin'\n\nexport default {\n  name: 'TemplateAside',\n  setup() {\n    const { builtinComponent } = useBuiltinComponent()\n\n    return { builtinComponent }\n  },\n  methods: {\n    /**\n     * @param {DragEvent} e\n     */\n    dragHandle(e) {\n      console.log('正在拖拉')\n    },\n    /**\n     * @param {DragEvent} e\n     * @param {Template.BuiltinComponentItem} data\n     */\n    dragstartHandle(e, data) {\n      console.log('开始拖拽')\n\n      /**\n       * @type {HTMLLIElement}\n       */\n      const el = e.target\n      const rect = el.getBoundingClientRect()\n\n      data.offset.x = e.pageX - rect.left\n      data.offset.y = e.pageY - rect.top\n\n      e.dataTransfer.dropEffect = 'move'\n      e.dataTransfer.effectAllowed = 'move'\n      e.dataTransfer.setData('application/json', JSON.stringify(data))\n    },\n    /**\n     * @param {DragEvent} e\n     */\n    dragendHandle(e) {\n      console.log('结束拖拽')\n      e.dataTransfer.clearData()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-aside {\n  width: 326px;\n}\n\n.template-aside-container {\n  position: relative;\n  padding: 0 10px;\n  margin-top: 12px;\n}\n\n.template-aside-title {\n  display: flex;\n  align-items: center;\n  height: 22px;\n  margin: 0;\n  font-size: 14px;\n  font-weight: normal;\n}\n\n.template-component-group {\n  position: relative;\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  grid-auto-rows: max-content;\n  gap: 10px;\n  padding: 8px;\n  margin: 12px 0 0;\n  overflow: hidden;\n  border: 1px solid var(--color-border-light);\n}\n\n.template-component-item {\n  padding: 6px;\n  font-size: 12px;\n  text-align: center;\n  cursor: grab;\n  user-select: none;\n  border: 1px solid var(--color-border-light);\n\n  &.used {\n    cursor: not-allowed;\n    background-color: var(--color-primary-light-7);\n  }\n\n  &:not(.used):active {\n    cursor: grabbing;\n  }\n}\n</style>\n","<template lang=\"pug\">\nheader.template-toolbar\n  el-button(type=\"text\" size=\"small\" icon=\"el-icon-arrow-left\" @click=\"goBack()\") 返回\n\n  .flex1\n\n  el-button(type=\"primary\" size=\"small\" @click=\"undo()\")\n    i.el-icon-back\n    | &nbsp;撤销\n\n  el-button(type=\"primary\" size=\"small\" @click=\"restore()\")\n    | 恢复&nbsp;\n    i.el-icon-right\n  el-button(type=\"primary\" size=\"small\" @click=\"stageClear()\") 清空画布\n  el-button(type=\"primary\" size=\"small\") 导入模板\n  el-button(type=\"primary\" size=\"small\" @click=\"action(actionType.open)\") 模板属性\n\n  el-dialog(\n    :visible.sync=\"dialog.visible\"\n    :close-on-click-modal=\"false\"\n    append-to-body\n    title=\"模板属性\"\n    width=\"500px\"\n    @keydown.native.enter=\"action(actionType.submit)\"\n    @closed=\"resetForm('formRef')\")\n    el-form(:model=\"form\" ref=\"formRef\" action=\"javascript:;\" size=\"medium\" label-suffix=\"：\" label-width=\"100px\")\n      el-form-item(label=\"模板名称\" prop=\"name\")\n        el-input(ref=\"templateName\" v-model=\"form.name\")\n\n      el-form-item(label=\"尺寸\" prop=\"size\")\n        el-radio-group(v-model=\"form.size\")\n          el-radio(:label=\"size.A4.name\") A4\n          el-radio(:label=\"size.A5.name\") A5\n\n      el-form-item(label=\"方向\" prop=\"direction\")\n        el-radio-group(v-model=\"form.direction\")\n          el-radio(label=\"vertical\") 纵向\n          el-radio(label=\"horizontal\") 横向\n\n      el-form-item(label=\"页面边距\" prop=\"padding\")\n        ol.template-toolbar-padding\n          li.template-toolbar-padding-item\n            label(for=\"padding-top\") 上：\n            el-row.template-toolbar-padding__inner(type=\"flex\" align=\"middle\")\n              el-input-number.flex1(\n                id=\"padding-top\"\n                size=\"small\"\n                :min=\"0\"\n                :max=\"40\"\n                :precision=\"1\"\n                :step=\"1\"\n                :controls=\"false\"\n                v-model=\"form.padding.top\")\n              span 毫米\n          li.template-toolbar-padding-item\n            label(for=\"padding-bottom\") 下：\n            el-row.template-toolbar-padding__inner(type=\"flex\" align=\"middle\")\n              el-input-number.flex1(\n                id=\"padding-bottom\"\n                size=\"small\"\n                :min=\"0\"\n                :max=\"40\"\n                :precision=\"1\"\n                :step=\"1\"\n                :controls=\"false\"\n                v-model=\"form.padding.bottom\")\n              span 毫米\n          li.template-toolbar-padding-item\n            label(for=\"padding-left\") 左：\n            el-row.template-toolbar-padding__inner(type=\"flex\" align=\"middle\")\n              el-input-number.flex1(\n                id=\"padding-left\"\n                size=\"small\"\n                :min=\"0\"\n                :max=\"40\"\n                :precision=\"1\"\n                :step=\"1\"\n                :controls=\"false\"\n                v-model=\"form.padding.left\")\n              span 毫米\n          li.template-toolbar-padding-item\n            label(for=\"padding-right\") 右：\n            el-row.template-toolbar-padding__inner(type=\"flex\" align=\"middle\")\n              el-input-number.flex1(\n                id=\"padding-right\"\n                size=\"small\"\n                :min=\"0\"\n                :max=\"40\"\n                :precision=\"1\"\n                :step=\"1\"\n                :controls=\"false\"\n                v-model=\"form.padding.right\")\n              span 毫米\n    el-row(slot=\"footer\" type=\"flex\" justify=\"end\")\n      el-button(type=\"primary\" size=\"small\" @click=\"action(actionType.submit)\") 确定\n      el-button(size=\"small\" @click=\"action(actionType.close)\") 取消\n</template>\n\n<script>\nimport { getCurrentInstance, inject, reactive, nextTick } from 'vue'\nimport { cloneDeep } from 'lodash-es'\nimport { storeSymbol, templateChannel } from '@/views/template/constant'\nimport { usePadding } from '@/views/template/hooks/usePadding'\nimport { useSize } from '@/views/template/hooks/useSize'\nimport { TemplateEvent } from '@/views/template/utils'\nimport { useDialog } from '@/hooks/useDialog'\nimport eventBus from '@/utils/eventBus'\n\nexport default {\n  name: 'TemplateToolbar',\n  setup() {\n    const vm = getCurrentInstance().proxy\n    /**\n     * @type {Template.Store}\n     */\n    const store = inject(storeSymbol)\n    const size = useSize()\n    const form = reactive({\n      name: '',\n      size: '',\n      direction: '',\n      padding: usePadding()\n    })\n\n    const {\n      state: dialog,\n      action,\n      actionType\n    } = useDialog({\n      open() {\n        form.name = store.name\n        form.size = store.size.name\n        form.direction = store.direction\n        form.padding = cloneDeep(store.padding)\n\n        nextTick(function () {\n          /**\n           * @type {import('element-ui').Input}\n           */\n          const templateNameInput = vm.$refs.templateName\n          templateNameInput.focus()\n        })\n      },\n      submit() {\n        store.name = form.name\n        store.direction = form.direction\n        store.size.name = form.size\n        store.padding = cloneDeep(form.padding)\n        action('action:hidden')\n      }\n    })\n\n    return { store, size, form, dialog, action, actionType }\n  },\n  methods: {\n    goBack() {\n      this.$router.go(-1)\n    },\n    stageClear() {\n      const event = new TemplateEvent(templateChannel.stageClear, {\n        detail: Array.from(this.store.components.values()),\n        target: 'toolbar'\n      })\n      eventBus.$emit(templateChannel.stageClear, event)\n    },\n    undo() {\n      const event = new TemplateEvent(templateChannel.stageClear, { detail: null, target: 'toolbar' })\n      eventBus.$emit(templateChannel.stageUndo, event)\n    },\n    restore() {\n      const event = new TemplateEvent(templateChannel.stageClear, { detail: null, target: 'toolbar' })\n      eventBus.$emit(templateChannel.stageRestore, event)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-toolbar {\n  position: relative;\n  z-index: 1;\n  display: flex;\n  padding: 8px 20px;\n  box-shadow: 0 0 8px 1px #bfbfbf;\n}\n\n.template-toolbar-padding {\n  display: inline-grid;\n  grid-template-columns: repeat(2, 1fr);\n  grid-auto-rows: max-content;\n  row-gap: 10px;\n  column-gap: 10px;\n  padding: 0;\n  margin: 0 40px 0 0;\n  color: var(--color-text-regular);\n}\n\n.template-toolbar-padding-item {\n  display: flex;\n  column-gap: 5px;\n}\n\n.template-toolbar-padding__inner {\n  column-gap: 5px;\n}\n</style>\n","import { reactive, readonly } from 'vue'\n\n/**\n * @param {object} options\n * @param {Function} options.submit\n * @param {Function} options.open\n */\nexport function useDialog(options) {\n  const actionType = readonly({\n    open: 'action:visible',\n    close: 'action:hidden',\n    submit: 'action:submit'\n  })\n\n  const state = reactive({\n    visible: false,\n    editor: true\n  })\n\n  /**\n   * @param {'action:visible'|'action:hidden'|'action:submit'} type\n   */\n  const action = function (type) {\n    switch (type) {\n      case actionType.open:\n        state.visible = true\n        options.open?.apply(null)\n        break\n      case actionType.close:\n        state.visible = false\n        break\n      case actionType.submit:\n        options.submit()\n    }\n  }\n\n  return { state, actionType, action }\n}\n","import { inject, onBeforeUnmount, onMounted, ref } from 'vue'\nimport { storeSymbol, templateChannel } from '@/views/template/constant'\nimport { getRect } from '@/views/template/utils'\nimport eventBus from '@/utils/eventBus'\n\n/**\n * @param {number} dragValue\n * @param {number} targetValue\n */\nfunction isNearly(dragValue, targetValue) {\n  return Math.abs(dragValue - targetValue) <= 5\n}\n\n/**\n * @type {Record<string, (rect1: Template.Rect, rect2: Template.Rect) => {visible: boolean, position: {left: number, top: number}}}}>}\n */\nconst conditions = {\n  yl(rect1, rect2) {\n    const ll = {\n      visible: isNearly(rect1.left, rect2.left),\n      position: { left: rect2.left, top: 0 }\n    }\n\n    const lr = {\n      visible: isNearly(rect1.left, rect2.right),\n      position: { left: rect2.right, top: 0 }\n    }\n\n    return ll.visible ? ll : lr\n  },\n  yc(rect1, rect2) {\n    return {\n      visible: isNearly(rect1.right - rect1.width / 2, rect2.right - rect2.width / 2),\n      position: { left: rect2.right - rect2.width / 2, top: 0 }\n    }\n  },\n  yr(rect1, rect2) {\n    const rr = {\n      visible: isNearly(rect1.right, rect2.right),\n      position: { left: rect2.right, top: 0 }\n    }\n\n    const rl = {\n      visible: isNearly(rect1.right, rect2.left),\n      position: { left: rect2.left, top: 0 }\n    }\n\n    return rr.visible ? rr : rl\n  },\n  xt(rect1, rect2) {\n    const tt = {\n      visible: isNearly(rect1.top, rect2.top),\n      position: { left: 0, top: rect2.top }\n    }\n\n    const tb = {\n      visible: isNearly(rect1.top, rect2.bottom),\n      position: { left: 0, top: rect2.bottom }\n    }\n\n    return tt.visible ? tt : tb\n  },\n  xc(rect1, rect2) {\n    return {\n      visible: isNearly(rect1.bottom - rect1.height / 2, rect2.bottom - rect2.height / 2),\n      position: { left: 0, top: rect2.bottom - rect2.height / 2 }\n    }\n  },\n  xb(rect1, rect2) {\n    const bb = {\n      visible: isNearly(rect1.bottom, rect2.bottom),\n      position: { left: 0, top: rect2.bottom }\n    }\n\n    const bt = {\n      visible: isNearly(rect1.bottom, rect2.top),\n      position: { left: 0, top: rect2.top }\n    }\n\n    return bb.visible ? bb : bt\n  }\n}\n\nexport function useMarkLine() {\n  /**\n   * @type {Template.Store}\n   */\n  const store = inject(storeSymbol)\n\n  /**\n   * @type {import('vue').Ref<Array<{type: 'yl'|'yc'|'yr'|'xt'|'xc'|'xb',direction: string, visible: boolean, position: {left: number, top: number}}>>}\n   */\n  const markLine = ref([\n    { type: 'yl', direction: 'vertical', visible: false, position: { left: 0, top: 0 } },\n    { type: 'yc', direction: 'vertical', visible: false, position: { left: 0, top: 0 } },\n    { type: 'yr', direction: 'vertical', visible: false, position: { left: 0, top: 0 } },\n    { type: 'xt', direction: 'horizontal', visible: false, position: { left: 0, top: 0 } },\n    { type: 'xc', direction: 'horizontal', visible: false, position: { left: 0, top: 0 } },\n    { type: 'xb', direction: 'horizontal', visible: false, position: { left: 0, top: 0 } }\n  ])\n\n  /**\n   * @param {Template.Event<Template.BuiltinComponent>} e\n   */\n  const moveHandle = function (e) {\n    const currentComponent = e.detail\n    const currentRect = getRect(currentComponent)\n\n    for (const [key, item] of store.components) {\n      if (key === currentComponent.uid) continue\n\n      const rect = getRect(item)\n\n      let condition = 0\n\n      for (const line of markLine.value) {\n        const { visible, position } = conditions[line.type].apply(null, [currentRect, rect])\n        line.visible = visible\n        line.position = position\n\n        if (visible) {\n          condition += 1\n\n          /**\n           * @type {[number, number]}\n           */\n          const [x, y] = [\n            position.left || currentComponent.props.position.x,\n            position.top || currentComponent.props.position.y\n          ]\n\n          switch (line.type) {\n            case 'xt':\n              currentComponent.props.position.x = x\n              currentComponent.props.position.y = y\n              break\n            case 'xc':\n              currentComponent.props.position.x = x\n              currentComponent.props.position.y = y - currentComponent.props.size.h / 2\n              break\n            case 'xb':\n              currentComponent.props.position.x = x\n              currentComponent.props.position.y = y - currentComponent.props.size.h\n              break\n            case 'yc':\n              currentComponent.props.position.x = x - currentComponent.props.size.w / 2\n              currentComponent.props.position.y = y\n              break\n            case 'yl':\n              currentComponent.props.position.x = x\n              currentComponent.props.position.y = y\n              break\n            case 'yr':\n              currentComponent.props.position.x = x - currentComponent.props.size.w\n              currentComponent.props.position.y = y\n              break\n          }\n        }\n      }\n\n      if (condition) break\n    }\n  }\n\n  /**\n   * @param {Template.BuiltinComponentType} type\n   * @param {Template.BuiltinComponent} component\n   */\n  const moveEndHandle = function (type, component) {\n    markLine.value.forEach(item => {\n      item.visible = false\n    })\n  }\n\n  onMounted(function () {\n    eventBus.$on(templateChannel.componentMove, moveHandle)\n    eventBus.$on(templateChannel.componentMoveEnd, moveEndHandle)\n  })\n\n  onBeforeUnmount(function () {\n    eventBus.$off(templateChannel.componentMove, moveHandle)\n    eventBus.$off(templateChannel.componentMoveEnd, moveEndHandle)\n  })\n\n  return { markLine }\n}\n","<template lang=\"pug\">\nmain.template-editor\n  section.template-canvas(ref=\"canvas\")\n    TemplateStage(\n      :scale=\"scale.value\"\n      :position=\"position\"\n      :spaceDown=\"spaceDown\"\n      :scale-manual=\"scale.manual\"\n      @keydown.space.exact.native=\"spaceDownHandle\"\n      @keyup.space.exact.native=\"spaceUpHandle\"\n      ref=\"refComponent\")\n  app-scale(\n    :scale.sync=\"scale.value\"\n    :max-scale=\"scale.max\"\n    :mini-scale=\"scale.mini\"\n    :step=\"scale.step\"\n    @change=\"scaleManual(true)\")\n</template>\n\n<script>\nimport { inject, getCurrentInstance, onBeforeUnmount, onMounted, reactive } from 'vue'\nimport { storeSymbol } from '@/views/template/constant'\nimport TemplateStage from './template-stage.vue'\n\nimport { useToHtml } from '@/views/template/hooks/useToHtml'\n\nexport default {\n  name: 'TemplateEditor',\n  components: {\n    TemplateStage\n  },\n  provide() {\n    return {\n      editorInstance: this\n    }\n  },\n  data() {\n    return {\n      /** 空格是否按下 */\n      spaceDown: false,\n      /** 相对父级偏移量 */\n      position: { x: 0, y: 0 },\n      /**\n       * 暂存偏移量\n       * @type {{x: number, y: number}|null}\n       */\n      stashPosition: null\n    }\n  },\n  setup() {\n    const vm = getCurrentInstance().proxy\n    /**\n     * @type {Template.Store}\n     */\n    const store = inject(storeSymbol)\n    const { refComponent } = useToHtml()\n    /** 缩放比例 */\n    const scale = reactive({ step: 5, value: 100, max: 200, mini: 20, manual: false })\n\n    /**\n     * @param {WheelEvent} e\n     */\n    const mousewheel = function (e) {\n      vm.scaleManual(false)\n\n      if (e.deltaY > 0) {\n        if (scale.value > scale.mini) scale.value -= scale.step\n      } else {\n        if (scale.value < scale.max) scale.value += scale.step\n      }\n\n      /** @type {HTMLElement} */\n      const stage = refComponent.value.$el\n      const rect = stage.getBoundingClientRect()\n\n      /** 鼠标距离元素 `left` 的比例 */\n      const leftScale = (e.clientX - rect.left) / rect.width\n      /** 鼠标距离元素 `top` 的比例 */\n      const topScale = (e.clientY - rect.top) / rect.height\n      /** 缩放后的元素宽度 */\n      const newStageWidth = store.size.width * (scale.value / 100)\n      /** 缩放后的元素高度 */\n      const newStageHeight = store.size.height * (scale.value / 100)\n      /** 缩放后的鼠标距离元素 left 值 */\n      const newRectLeft = newStageWidth * leftScale\n      /** 缩放后的鼠标距离元素 top 值 */\n      const newRectTop = newStageHeight * topScale\n\n      // 当前位置 = 当前位置 - (缩放后的 `left/top` - （鼠标距离元素 `left/top` 值))\n      vm.position.x = vm.position.x - (newRectLeft - (e.clientX - rect.left))\n      vm.position.y = vm.position.y - (newRectTop - (e.clientY - rect.top))\n    }\n\n    onMounted(function () {\n      vm.$el.addEventListener('mousewheel', mousewheel)\n    })\n\n    onBeforeUnmount(function () {\n      vm.$el.removeEventListener('mousewheel', mousewheel)\n    })\n\n    return { scale, store, refComponent }\n  },\n  mounted() {\n    const context = this\n    /** @type {HTMLElement} */\n    const stage = this.refComponent.$el\n\n    /**\n     * @param {Event} e\n     */\n    const resize = function (e) {\n      context.init()\n    }\n\n    /**\n     * @param {PointerEvent} e\n     */\n    const pointerdown = function (e) {\n      if (context.spaceDown && e.button === 0) {\n        context.stashPosition = {\n          x: e.clientX - stage.offsetLeft,\n          y: e.clientY - stage.offsetTop\n        }\n      }\n    }\n\n    /**\n     * @param {PointerEvent} e\n     */\n    const pointermove = function (e) {\n      if (context.spaceDown && context.stashPosition) {\n        context.position.x = e.clientX - context.stashPosition.x\n        context.position.y = e.clientY - context.stashPosition.y\n      }\n    }\n\n    /**\n     * @param {PointerEvent} e\n     */\n    const pointerup = function (e) {\n      context.stashPosition = null\n    }\n\n    window.addEventListener('resize', resize)\n    window.addEventListener('pointerdown', pointerdown)\n    window.addEventListener('pointermove', pointermove)\n    window.addEventListener('pointerup', pointerup)\n\n    this.$once('hook:beforeDestroy', function () {\n      window.removeEventListener('resize', resize)\n      window.removeEventListener('pointerdown', pointerdown)\n      window.removeEventListener('pointermove', pointermove)\n      window.removeEventListener('pointerup', pointerup)\n    })\n\n    window.dispatchEvent(new Event('resize'))\n  },\n  methods: {\n    /**\n     * 初始化 画布位置\n     */\n    init() {\n      /** @type {HTMLElement} */\n      const canvas = this.$refs.canvas\n\n      const x = (canvas.offsetWidth - this.store.size.width) / 2\n      const y = (canvas.offsetHeight - this.store.size.height) / 2\n\n      this.position.x = x\n      this.position.y = y\n    },\n    /**\n     * @param {KeyboardEvent} e\n     */\n    spaceDownHandle(e) {\n      /** @type {HTMLElement} */\n      const target = e.target\n      this.spaceDown = true\n      target.style.cursor = 'grab'\n    },\n    /**\n     * @param {KeyboardEvent} e\n     */\n    spaceUpHandle(e) {\n      /** @type {HTMLElement} */\n      const target = e.target\n      target.style.cursor = 'default'\n      this.spaceDown = false\n    },\n    /**\n     * @param {boolean} manual 是否点击缩放\n     */\n    scaleManual(manual) {\n      this.scale.manual = manual\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-editor {\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n}\n\n.template-canvas {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-color: var(--color-background-light-gray);\n}\n</style>\n","<template lang=\"pug\">\n.template-stage(\n  tabindex=\"-1\"\n  :style=\"stageStyle\"\n  @pointerdown=\"unSelectComponent\"\n  @keydown.delete=\"deleteComponent\"\n  @drop=\"dropHandle\"\n  @dragover.prevent=\"noop\")\n  TemplateContextmenu(:scale=\"scale\")\n  TemplateArea(:scale=\"scale\" @area=\"area\")\n  TemplateMarkLine(v-for=\"item of markLine\"\n    :key=\"item.type\"\n    :position=\"item.position\"\n    :direction=\"item.direction\"\n    :visible=\"item.visible\")\n  TemplateControl(v-for=\"component of store.componentsData\"\n    v-model=\"component.visible\"\n    :key=\"component.id\"\n    :scale=\"scale\"\n    :lock=\"component.props.lock\"\n    :zIndex=\"component.props.zIndex\"\n    :position.sync=\"component.props.position\"\n    :size.sync=\"component.props.size\"\n    @moveStart=\"moveStart(component)\"\n    @move=\"move(component)\"\n    @moveEnd=\"moveEnd(component)\"\n    @resizeStart=\"resizeStart(component)\"\n    @resize=\"resize(component)\"\n    @resizeEnd=\"resizeEnd(component)\"\n    @select=\"selectComponent(component)\")\n    component(\n      top\n      group\n      ref=\"builtinGroupComponentRef\"\n      :is=\"component.name\"\n      :children=\"component.children\"\n      v-bind=\"component.props\"\n      v-if=\"component.name === 'builtin-group'\")\n    component(\n      ref=\"builtinComponentRef\"\n      :is=\"component.name\"\n      v-bind=\"component.props\"\n      v-else)\n</template>\n\n<script>\nimport { inject } from 'vue'\nimport { builtinComponent } from '@/views/template/components/builtin'\nimport { storeSymbol, templateChannel } from '@/views/template/constant'\nimport { useMarkLine } from '@/views/template/hooks/useMarkLine'\nimport { TemplateEvent, shapeLocation } from '@/views/template/utils'\nimport eventBus from '@/utils/eventBus'\n\nexport default {\n  name: 'TemplateStage',\n  components: {\n    BuiltinInput: () => import('../components/builtin/builtin-input.vue'),\n    BuiltinGroup: () => import('../components/builtin/builtin-group.vue'),\n    BuiltinSelect: () => import('../components/builtin/builtin-select.vue'),\n    TemplateControl: () => import('../components/template-control.vue'),\n    TemplateMarkLine: () => import('../components/template-mark-line.vue'),\n    TemplateArea: () => import('../components/template-area.vue'),\n    TemplateContextmenu: () => import('../components/template-contextmenu.vue')\n  },\n  props: {\n    scale: {\n      type: Number,\n      required: true\n    },\n    position: {\n      type: Object,\n      required: true\n    },\n    spaceDown: {\n      type: Boolean,\n      required: true\n    },\n    scaleManual: {\n      type: Boolean,\n      required: false\n    }\n  },\n  provide() {\n    return {\n      stageInstance: this\n    }\n  },\n  setup() {\n    /**\n     * @type {Template.Store}\n     */\n    const store = inject(storeSymbol)\n    const { markLine } = useMarkLine()\n\n    return { store, markLine }\n  },\n  computed: {\n    stageStyle() {\n      return {\n        borderLeftWidth: this.store.padding.left + 'mm',\n        borderTopWidth: this.store.padding.top + 'mm',\n        borderRightWidth: this.store.padding.right + 'mm',\n        borderBottomWidth: this.store.padding.bottom + 'mm',\n        width: this.store.size.width + 'px',\n        height: this.store.size.height + 'px',\n        left: this.position.x + 'px',\n        top: this.position.y + 'px',\n        transformOrigin: this.scaleManual ? 'center' : 'left top',\n        transform: `scale3d(${this.scale / 100}, ${this.scale / 100}, 1)`\n      }\n    }\n  },\n  methods: {\n    /**\n     * @param {DragEvent} e\n     */\n    dropHandle(e) {\n      const response = e.dataTransfer.getData('application/json')\n      /**\n       * @type {Template.BuiltinComponentItem}\n       */\n      const data = JSON.parse(response)\n      const component = builtinComponent.get(data.id).create()\n      const [x, y] = shapeLocation({ x: e.pageX, y: e.pageY, el: this.$el }, this.scale / 100)\n\n      component.props.position.x = x - data.offset.x\n      component.props.position.y = y - data.offset.y\n      component.shapeId = data.id\n\n      const event = new TemplateEvent(templateChannel.componentAdd, {\n        detail: component,\n        target: 'stage'\n      })\n\n      eventBus.$emit(templateChannel.componentAdd, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    selectComponent(component) {\n      const event = new TemplateEvent(templateChannel.componentSelect, {\n        detail: component,\n        target: 'stage'\n      })\n      eventBus.$emit(templateChannel.componentSelect, event)\n    },\n    unSelectComponent() {\n      if (this.store.currentComponent) {\n        if (this.store.currentComponent.children && !this.store.currentComponent.builtin) {\n          const event = new TemplateEvent(templateChannel.componentSelectUn, {\n            detail: this.store.currentComponent,\n            target: 'stage'\n          })\n          eventBus.$emit(templateChannel.groupUn, event)\n          return\n        }\n\n        const event = new TemplateEvent(templateChannel.componentSelectUn, { detail: null, target: 'stage' })\n        eventBus.$emit(templateChannel.componentSelectUn, event)\n      }\n    },\n    /**\n     * @param {KeyboardEvent} e\n     */\n    deleteComponent(e) {\n      if (this.store.currentComponent) {\n        const component = this.store.currentComponent\n        const event = new TemplateEvent(templateChannel.componentDel, { detail: component, target: 'stage' })\n        eventBus.$emit(templateChannel.componentDel, event)\n      }\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    moveStart(component) {\n      const event = new TemplateEvent(templateChannel.componentMoveStart, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentMoveStart, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    move(component) {\n      const event = new TemplateEvent(templateChannel.componentMove, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentMove, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    moveEnd(component) {\n      const event = new TemplateEvent(templateChannel.componentMoveEnd, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentMoveEnd, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    resizeStart(component) {\n      const event = new TemplateEvent(templateChannel.componentResizeStart, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentResizeStart, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    resize(component) {\n      const event = new TemplateEvent(templateChannel.componentResize, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentResize, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    resizeEnd(component) {\n      const event = new TemplateEvent(templateChannel.componentResizeEnd, { detail: component, target: 'stage' })\n      eventBus.$emit(templateChannel.componentResizeEnd, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent[]} data\n     */\n    area(data) {\n      // 如果选中个数 大于 1 的时候 创建组 否则 选择组件\n      if (data.length > 1) {\n        const event = new TemplateEvent(templateChannel.groupPack, { detail: data, target: 'stage' })\n        eventBus.$emit(templateChannel.groupPack, event)\n        return\n      }\n\n      this.selectComponent(data[0])\n    },\n    toHtml() {\n      /**\n       * @type {Vue[]}\n       */\n      const builtinGroupComponentRef = Array.isArray(this.$refs.builtinGroupComponentRef)\n        ? this.$refs.builtinGroupComponentRef\n        : [this.$refs.builtinGroupComponentRef]\n\n      /**\n       * @type {Vue[]}\n       */\n      const builtinComponentRef = Array.isArray(this.$refs.builtinComponentRef)\n        ? this.$refs.builtinComponentRef\n        : [this.$refs.builtinComponentRef]\n\n      /**\n       * @type {HTMLElement}\n       */\n      const root = this.$el.cloneNode()\n      const fragment = document.createDocumentFragment()\n      const style = window.getComputedStyle(this.$el)\n\n      root.style.left = ''\n      root.style.top = ''\n      root.style.transform = ''\n      root.style.position = 'relative'\n      root.style.border = style.border\n      root.style.boxShadow = style.boxShadow\n      root.style.backgroundImage = style.backgroundImage\n      root.style.backgroundRepeat = style.backgroundRepeat\n\n      builtinGroupComponentRef\n        .concat(builtinComponentRef)\n        .filter(Boolean)\n        .forEach(function (item) {\n          fragment.append(item.toHtml())\n        })\n\n      root.appendChild(fragment)\n\n      return root\n    }\n  },\n  watch: {\n    scale(val) {\n      const event = new TemplateEvent(templateChannel.stageScaleChange, { detail: null, target: 'stage' })\n      eventBus.$emit(templateChannel.stageScaleChange, event)\n    },\n    position: {\n      handler(val) {\n        const event = new TemplateEvent(templateChannel.stageMove, { detail: null, target: 'stage' })\n        eventBus.$emit(templateChannel.stageMove, event)\n      },\n      deep: true\n    },\n    'store.size': {\n      handler(val) {\n        window.dispatchEvent(new Event('resize'))\n        eventBus.$emit(templateChannel.stageSizeChange, val)\n      },\n      deep: true\n    },\n    'store.padding': {\n      handler(val) {\n        eventBus.$emit(templateChannel.stagePaddingChange, val)\n      },\n      deep: true\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-stage {\n  position: absolute;\n  background-image: url('@/views/template/action/image/sprite.svg');\n  background-repeat: repeat;\n  border: 0 solid #f2f2f2;\n  outline: none;\n  box-shadow: 0 0 8px 1px darken($color: #f2f2f2, $amount: 20%);\n  transform-origin: center;\n}\n</style>\n","import { onBeforeUnmount, onMounted, ref } from 'vue'\nimport { templateChannel } from '@/views/template/constant'\nimport eventBus from '@/utils/eventBus'\n\nexport function useToHtml() {\n  /**\n   * @type {import('vue').Ref<Vue>}\n   */\n  const refComponent = ref(null)\n\n  const toHtml = function () {\n    const node = refComponent.value.toHtml()\n    node.style.margin = '0 auto'\n\n    const html = /* html */ `\n      <html lang=\"zh-CN\">\n        <head>\n          <meta charset=\"utf-8\" />\n          <title>模板预览</title>\n          <style>\n            * {\n              padding: 0;\n              margin: 0;\n              box-sizing: border-box;\n            }\n          </style>\n        </head>\n        <body style=\"padding: 20px 0;background-color: #fafafa\">\n          ${node.outerHTML}\n        </body>\n      </html>\n    `\n\n    const blob = new Blob([html], { type: 'text/html' })\n    const url = URL.createObjectURL(blob)\n\n    window.open(url, '_blank', 'width=1024,height=768,scrollbars')\n  }\n\n  onMounted(function () {\n    eventBus.$on(templateChannel.editorToHtml, toHtml)\n  })\n\n  onBeforeUnmount(function () {\n    eventBus.$off(templateChannel.editorToHtml, toHtml)\n  })\n\n  return { refComponent }\n}\n","import { ref, watch } from 'vue'\n\nconst builtinComponentName = {\n  input: 'builtin-input',\n  select: 'builtin-select'\n}\n\nconst builtinComponentPropertySetting = {\n  [builtinComponentName.input]: {\n    setting: [\n      { label: '锁定位置', type: 'lock', value: false },\n      { label: '显示下划线', type: 'underline', value: false },\n      { label: '设为虚线', type: 'dash', value: false },\n      { label: '设为必填', type: 'required', value: false }\n    ]\n  },\n  [builtinComponentName.select]: {\n    setting: [\n      { label: '锁定位置', type: 'lock', value: false },\n      { label: '设为必填', type: 'required', value: false }\n    ],\n    option: [\n      {\n        label: '选项',\n        type: 'option'\n      }\n    ]\n  }\n}\n\n/**\n * @param {import('vue').Ref<Template.BuiltinComponent>} component\n * @returns {import('vue').Ref<null>}\n */\nexport function useSetting(component) {\n  const result = ref(null)\n\n  if (component.value) {\n    result.value = builtinComponentPropertySetting[component.value.name]\n  }\n\n  watch(\n    () => component.value,\n    function (val) {\n      result.value = val ? builtinComponentPropertySetting[val.name] : null\n    }\n  )\n\n  return result\n}\n","<template lang=\"pug\">\naside.template-property\n  section.template-property-container(@pointerdown.stop=\"noop\" v-if=\"currentComponent\")\n    .template-property-item\n      section.flex1\n        h1 字体\n        .template-property-item\n          el-select.flex1(\n            v-model=\"current.property.fontFamily.value\"\n            :popper-append-to-body=\"false\"\n            size=\"mini\"\n            @change=\"componentFontChange(currentComponent)\")\n            el-option(v-for=\"(font, k) in fonts\" :key=\"k\" :label=\"font.label\" :value=\"font.value\")\n          el-select(\n            v-model=\"current.property.fontSize.value\"\n            :popper-append-to-body=\"false\"\n            size=\"mini\"\n            style=\"width: 74px\"\n            @change=\"componentFontSizeChange(currentComponent)\")\n            el-option(v-for=\"(fontSiz, k) in fontSizes\" :key=\"k\" :label=\"fontSiz.label\" :value=\"fontSiz.value\")\n\n    .template-property-item\n      label 控件名称\n      span {{ current.label }}\n    .template-property-item\n      label 位置\n      ol.template-property-grid.flex1\n        li.template-property-list-item\n          el-input-number.flex1(\n            size=\"mini\"\n            :disabled=\"current.lock\"\n            :min=\"0\"\n            :precision=\"0\"\n            :controls=\"false\"\n            v-model=\"current.position.x\"\n            @change=\"componentMove(currentComponent)\")\n          span X\n        li.template-property-list-item\n          el-input-number.flex1(\n            size=\"mini\"\n            :disabled=\"current.lock\"\n            :min=\"0\"\n            :precision=\"0\"\n            :controls=\"false\"\n            v-model=\"current.position.y\"\n            @change=\"componentMove(currentComponent)\")\n          span Y\n    .template-property-item\n      label 大小\n      ol.template-property-grid.flex1\n        li.template-property-list-item\n          el-input-number.flex1(\n            size=\"mini\"\n            :min=\"0\"\n            :precision=\"0\"\n            :controls=\"false\"\n            v-model=\"current.size.w\"\n            @change=\"componentSizeChange(currentComponent)\")\n          span W\n        li.template-property-list-item\n          el-input-number.flex1(\n            size=\"mini\"\n            :min=\"0\"\n            :precision=\"0\"\n            :controls=\"false\"\n            v-model=\"current.size.h\"\n            @change=\"componentSizeChange(currentComponent)\")\n          span H\n\n    .template-property-item(v-if=\"property\")\n      label 设置\n      ol.template-property-list.flex1\n        li.template-property-list-item(v-for=\"item of property.setting\" :key=\"item.type\")\n          el-checkbox(\n            :label=\"item.value\"\n            v-model=\"current.lock\"\n            v-if=\"item.type === 'lock'\") {{ item.label }}\n          el-checkbox(\n            :label=\"item.value\"\n            v-model=\"current.property.underline\"\n            v-if=\"item.type === 'underline'\") {{ item.label }}\n          el-checkbox(\n            :label=\"item.value\"\n            v-model=\"current.property.dashed\"\n            v-if=\"item.type === 'dash' && current.property.underline\") {{ item.label }}\n          el-checkbox(\n            :label=\"item.value\"\n            v-model=\"current.required\"\n            v-if=\"item.type === 'required'\") {{ item.label }}\n\n    TemplatePropertyOption(v-if=\"property && property.option\" :option=\"property.option\" :current=\"current\")\n\n  .flex1\n\n  section.template-property-action\n    div\n      el-button.fluid(type=\"primary\" size=\"small\" @click=\"print()\") 打印预览\n    div\n      el-button.fluid(type=\"primary\" size=\"small\" @click=\"save()\") 保存并导出\n</template>\n\n<script>\nimport { computed, inject } from 'vue'\nimport { useSetting } from '@/views/template/hooks/useSetting'\nimport { useFont, useFontSize } from '@/views/template/hooks/useProperty'\nimport { storeSymbol, templateChannel } from '@/views/template/constant'\nimport { TemplateEvent } from '@/views/template/utils'\nimport eventBus from '@/utils/eventBus'\n\nexport default {\n  name: 'TemplateProperty',\n  components: {\n    TemplatePropertyOption: () => import('./template-property-option.vue')\n  },\n  setup() {\n    /**\n     * @type {Template.Store}\n     */\n    const store = inject(storeSymbol)\n    const { fonts } = useFont()\n    const { fontSizes } = useFontSize()\n    /**\n     * @type {import('vue').Ref<Template.BuiltinComponent>}\n     */\n    const currentComponent = computed(() => store.currentComponent)\n    const property = useSetting(currentComponent)\n\n    const current = computed(() => {\n      if (currentComponent.value) {\n        return currentComponent.value.props\n      }\n\n      return null\n    })\n\n    return { currentComponent, fonts, fontSizes, current, property }\n  },\n  methods: {\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    componentMove(component) {\n      const event = new TemplateEvent(templateChannel.componentMoveEnd, { detail: component, target: 'property' })\n      eventBus.$emit(templateChannel.componentMoveEnd, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    componentSizeChange(component) {\n      const event = new TemplateEvent(templateChannel.componentResizeEnd, { detail: component, target: 'property' })\n      eventBus.$emit(templateChannel.componentResizeEnd, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    componentFontChange(component) {\n      const event = new TemplateEvent(templateChannel.componentFontChange, { detail: component, target: 'property' })\n      eventBus.$emit(templateChannel.componentFontChange, event)\n    },\n    /**\n     * @param {Template.BuiltinComponent} component\n     */\n    componentFontSizeChange(component) {\n      const event = new TemplateEvent(templateChannel.componentFontSizeChange, {\n        detail: component,\n        target: 'property'\n      })\n      eventBus.$emit(templateChannel.componentFontSizeChange, event)\n    },\n    print() {\n      eventBus.$emit(templateChannel.editorToHtml)\n    },\n    save() {}\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-property {\n  display: flex;\n  flex-direction: column;\n  width: 242px;\n  padding: 0 10px;\n  font-size: 12px;\n}\n\n.template-property-action {\n  display: flex;\n  flex-direction: column;\n  row-gap: 10px;\n  padding: 20px 20px 30px;\n  margin: 0 -10px;\n  box-shadow: 0 0 4px 1px #bfbfbf;\n}\n\n.template-property-container {\n  display: flex;\n  flex-direction: column;\n  row-gap: 15px;\n}\n\n.template-property-item {\n  display: flex;\n  column-gap: 10px;\n  align-items: flex-start;\n}\n\n.template-property-grid {\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  grid-auto-rows: max-content;\n  gap: 10px 15px;\n  padding: 0;\n  margin: 0;\n}\n\n.template-property-list {\n  display: flex;\n  flex-direction: column;\n  row-gap: 10px;\n  padding: 0;\n  margin: 0;\n}\n\n.template-property-list-item {\n  display: flex;\n  column-gap: 10px;\n  align-items: center;\n}\n</style>\n","<template lang=\"pug\">\nmain.template-container\n  TemplateToolbar\n  el-container.template-main\n    TemplateAside\n    TemplateEditor\n    TemplateProperty\n</template>\n\n<script>\nimport { onMounted, onUnmounted, provide, reactive, ref } from 'vue'\nimport { useStore } from '@/views/template/hooks/useStore'\nimport { useRecord } from '@/views/template/hooks/useRecord'\nimport { recordHandle } from '@/views/template/utils/record'\nimport { recordChannel, templateChannel, storeSymbol } from '@/views/template/constant'\nimport { createId, removeGroupComponent, createBuiltinComponentGroup, TemplateEvent } from '@/views/template/utils'\nimport eventBus from '@/utils/eventBus'\n\nimport TemplateAside from './template-aside.vue'\nimport TemplateToolbar from './template-toolbar.vue'\nimport TemplateEditor from './template-editor.vue'\nimport TemplateProperty from './template-property.vue'\n\nconst type = ['create', 'edit']\n\nexport default {\n  name: 'TemplateAction',\n  beforeRouteEnter(to, from, next) {\n    if (type.indexOf(to.query.type) > -1) {\n      next()\n      return\n    }\n\n    next({ path: '/template/action?type=create', replace: true })\n  },\n  components: {\n    TemplateAside,\n    TemplateToolbar,\n    TemplateEditor,\n    TemplateProperty\n  },\n  props: {\n    type: {\n      type: String,\n      required: true\n    }\n  },\n  setup() {\n    const store = useStore()\n    const index = ref(0)\n\n    provide(storeSymbol, store)\n    useRecord(store)\n\n    /**\n     * 添加组件\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     * @param {boolean} [record] 是否添加到历史记录\n     */\n    const addComponent = function (e, record = true) {\n      const component = reactive(e.detail)\n\n      component.uid = index.value++\n      component.id = createId(component.uid)\n      component.visible = true\n\n      if (component.children) {\n        component.children.forEach(function (item) {\n          item.uid = index.value++\n          item.id = createId(item.uid)\n        })\n      }\n\n      store.components.set(component.uid, component)\n      store.currentComponent = component\n      store.changes += 1\n\n      if (record) {\n        eventBus.$emit(recordChannel.componentAdd, e)\n      }\n    }\n\n    /**\n     * 删除组件\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     * @param {boolean} [record]\n     */\n    const delComponent = function (e, record = true) {\n      const component = e.detail\n\n      store.currentComponent = null\n      store.components.delete(component.uid)\n      store.changes += 1\n\n      if (record) {\n        eventBus.$emit(recordChannel.componentDel, e)\n      }\n    }\n\n    /**\n     * 选择组件\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const selectComponent = function (e) {\n      store.currentComponent = e.detail\n      store.currentComponent.visible = true\n      eventBus.$emit(recordChannel.componentSelect, e)\n    }\n\n    /**\n     * 取消选择组件\n     */\n    const unSelectComponent = function (e) {\n      store.currentComponent = null\n      eventBus.$emit(recordChannel.componentSelectUn, e)\n    }\n\n    /**\n     * 移动组件\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const moveComponentStart = function (e) {\n      eventBus.$emit(recordChannel.componentMoveStart, e)\n    }\n    /**\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const moveComponent = function (e) {\n      eventBus.$emit(recordChannel.componentMove, e)\n    }\n    /**\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const moveComponentEnd = function (e) {\n      eventBus.$emit(recordChannel.componentMoveEnd, e)\n    }\n\n    /**\n     * 组件修改大小\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const resizeComponentStart = function (e) {\n      eventBus.$emit(recordChannel.componentResizeStart, e)\n    }\n    /**\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const resizeComponent = function (e) {\n      eventBus.$emit(recordChannel.componentResize, e)\n    }\n    /**\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const resizeComponentEnd = function (e) {\n      eventBus.$emit(recordChannel.componentResizeEnd, e)\n    }\n\n    /**\n     * 字体改变\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const componentFontChange = function (e) {\n      eventBus.$emit(recordChannel.componentFontChange, e)\n    }\n\n    /**\n     * 清空画布\n     * @param {Template.Event} e\n     */\n    const stageClear = function (e) {\n      store.components.clear()\n      store.currentComponent = null\n\n      eventBus.$emit(recordChannel.stageClear, e)\n      store.changes += 1\n    }\n\n    /**\n     * 创建组\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const groupPack = function (e) {\n      const groupComponent = createBuiltinComponentGroup(e.detail)\n\n      for (const item of groupComponent.children) {\n        store.components.delete(item.uid)\n      }\n\n      const event = new TemplateEvent(templateChannel.componentAdd, { detail: groupComponent, target: 'stage' })\n\n      eventBus.$emit(templateChannel.componentAdd, event)\n    }\n\n    /**\n     * 组解散\n     * @param {Template.Event<Template.BuiltinComponent>} e\n     */\n    const groupUn = function (e) {\n      const components = removeGroupComponent(e.detail)\n\n      for (const item of components) {\n        const event = new TemplateEvent(templateChannel.componentAdd, { detail: item, target: 'stage' })\n        eventBus.$emit(templateChannel.componentAdd, event, false)\n      }\n\n      eventBus.$emit(recordChannel.groupUn, e)\n      eventBus.$emit(templateChannel.componentDel, e, false)\n    }\n\n    /**\n     * 撤销\n     */\n    const stageUndo = function () {\n      const popRecord = store.record.pop()\n\n      if (popRecord) {\n        recordHandle.apply(store, ['undo', popRecord])\n      }\n    }\n\n    /**\n     * 重做\n     */\n    const stageRestore = function () {\n      const popRecord = store.restore.pop()\n\n      if (popRecord) {\n        recordHandle.apply(store, ['restore', popRecord])\n      }\n    }\n\n    onMounted(function () {\n      eventBus.$on(templateChannel.componentAdd, addComponent)\n      eventBus.$on(templateChannel.componentDel, delComponent)\n      eventBus.$on(templateChannel.componentSelect, selectComponent)\n      eventBus.$on(templateChannel.componentSelectUn, unSelectComponent)\n      eventBus.$on(templateChannel.componentMoveStart, moveComponentStart)\n      eventBus.$on(templateChannel.componentMove, moveComponent)\n      eventBus.$on(templateChannel.componentMoveEnd, moveComponentEnd)\n      eventBus.$on(templateChannel.componentResizeStart, resizeComponentStart)\n      eventBus.$on(templateChannel.componentResize, resizeComponent)\n      eventBus.$on(templateChannel.componentResizeEnd, resizeComponentEnd)\n      eventBus.$on(templateChannel.componentFontChange, componentFontChange)\n      eventBus.$on(templateChannel.groupPack, groupPack)\n      eventBus.$on(templateChannel.groupUn, groupUn)\n      eventBus.$on(templateChannel.stageClear, stageClear)\n      eventBus.$on(templateChannel.stageUndo, stageUndo)\n      eventBus.$on(templateChannel.stageRestore, stageRestore)\n    })\n\n    onUnmounted(function () {\n      eventBus.$off(templateChannel.componentAdd, addComponent)\n      eventBus.$off(templateChannel.componentDel, delComponent)\n      eventBus.$off(templateChannel.componentSelect, selectComponent)\n      eventBus.$off(templateChannel.componentSelectUn, unSelectComponent)\n      eventBus.$off(templateChannel.componentMoveStart, moveComponentStart)\n      eventBus.$off(templateChannel.componentMove, moveComponent)\n      eventBus.$off(templateChannel.componentMoveEnd, moveComponentEnd)\n      eventBus.$off(templateChannel.componentResizeStart, resizeComponentStart)\n      eventBus.$off(templateChannel.componentResize, resizeComponent)\n      eventBus.$off(templateChannel.componentResizeEnd, resizeComponentEnd)\n      eventBus.$off(templateChannel.componentFontChange, componentFontChange)\n      eventBus.$off(templateChannel.groupPack, groupPack)\n      eventBus.$off(templateChannel.groupUn, groupUn)\n      eventBus.$off(templateChannel.stageClear, stageClear)\n      eventBus.$off(templateChannel.stageUndo, stageUndo)\n      eventBus.$off(templateChannel.stageRestore, stageRestore)\n    })\n\n    return { store, index }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-container {\n  display: flex;\n  flex-direction: column;\n  height: inherit;\n  background-color: var(--color-background);\n}\n\n.template-main {\n  position: relative;\n  overflow: hidden;\n}\n</style>\n"],"file":"static/js/template.5c0feb83.js"}