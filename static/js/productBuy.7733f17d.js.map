{"version":3,"mappings":"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","names":["goodInfo","Mock","mock","id","title","price","specs","attr","select","value","label","img","specCombinationList","spec","AdjoinMatrix","constructor","vertex","this","quantity","length","adjoinMatrix","Map","Array","fill","entries","setAdjoinVertex","sides","pIndex","indexOf","self","forEach","item","index","set","getVertexCol","col","push","get","getColSum","ids","idsVertex","map","idsVertexSum","i","rowTotal","reduce","total","current","getCollection","idsSum","collections","sum","getUnions","unions","SpecMatrix","specList","super","previousValue","currentValue","concat","val","init","initSpec","prevSpec","filter","getSpecsOptions","specOptionCanChoose","some","Boolean","createSpecCombinationMap","data","result","key","join","name","props","type","Number","required","components","specGroup","__vitePreload","import","specItem","detail","specCombinationMap","specMatrix","computed","form","optionSpecs","currentSpec","mounted"],"sources":["../../../src/mock/goods.js","../../../src/views/product/utils/adjoin-matrix.js","../../../src/views/product/buy/index.vue?chunkName=productBuy"],"sourcesContent":["import Mock from 'mockjs'\n\n/**\n * @type {Product.Detail}\n */\nexport const goodInfo = Mock.mock({\n  id: '@id',\n  title: '@cword(48)',\n  price: '@integer(1,100)',\n  'album|5': ['@image(1200x1200, @color)'],\n  specs: [\n    {\n      id: 1,\n      attr: '颜色',\n      select: '',\n      value: [\n        { id: 0, label: '红色' },\n        { id: 1, label: '绿色' },\n        { id: 2, label: '蓝色' },\n        { id: 3, label: '紫色' }\n      ],\n      img: '@image(800x800, @color, @first)'\n    },\n    {\n      id: 2,\n      attr: '尺码',\n      select: '',\n      value: [\n        { id: 0, label: 'M' },\n        { id: 1, label: 'L' },\n        { id: 2, label: 'XL' }\n      ],\n      img: '@image(800x800, @color, @first)'\n    },\n    {\n      id: 3,\n      attr: '版型',\n      select: '',\n      value: [\n        { id: 0, label: '宽松' },\n        { id: 1, label: '紧致' }\n      ],\n      img: '@image(800x800, @color, @first)'\n    }\n  ]\n})\n\n/**\n * @type {Product.SpecCombination[]}\n */\nexport const specCombinationList = [\n  {\n    id: 0,\n    spec: [\n      { id: 1, label: '颜色', value: '红色' },\n      { id: 2, label: '尺码', value: 'L' },\n      { id: 3, label: '版型', value: '紧致' }\n    ]\n  },\n  {\n    id: 1,\n    spec: [\n      { id: 1, label: '颜色', value: '绿色' },\n      { id: 2, label: '尺码', value: 'L' },\n      { id: 3, label: '版型', value: '紧致' }\n    ]\n  },\n  {\n    id: 3,\n    spec: [\n      { id: 1, label: '颜色', value: '紫色' },\n      { id: 2, label: '尺码', value: 'XL' },\n      { id: 3, label: '版型', value: '宽松' }\n    ]\n  }\n]\n","/**\n * @param {Product.CommoditySpecs[]} data\n */\nfunction createSpecVertex(data) {\n  /**\n   * @type {string[]}\n   */\n  const vertex = data.reduce(function (previousValue, currentValue) {\n    return previousValue.concat(currentValue.value.map(val => val.label))\n  }, [])\n\n  return vertex\n}\n\nclass AdjoinMatrix {\n  /**\n   * @param {string[]} vertex\n   */\n  constructor(vertex) {\n    /**\n     * 所有顶点集合\n     * @type {string[]}\n     */\n    this.vertex = vertex\n\n    /**\n     * @type {number}\n     */\n    this.quantity = this.vertex.length\n\n    /**\n     * 邻接矩阵\n     * @type {Map<number, number>}\n     */\n    this.adjoinMatrix = new Map(\n      Array(this.quantity ** 2)\n        .fill(0)\n        .entries()\n    )\n  }\n\n  /**\n   * 传入一个顶点，和当前顶点可达的顶点集合，将对应位置置为1\n   * @param {string} id 顶点\n   * @param {string[]} sides 当前顶点可到达顶点集合\n   */\n  setAdjoinVertex(id, sides) {\n    const pIndex = this.vertex.indexOf(id)\n    const self = this\n\n    sides.forEach(function (item) {\n      const index = self.vertex.indexOf(item)\n      self.adjoinMatrix.set(pIndex * self.quantity + index, 1)\n    })\n  }\n\n  /**\n   * 传入顶点的值，获取该顶点的列\n   * @param {string} id\n   */\n  getVertexCol(id) {\n    const index = this.vertex.indexOf(id)\n    /**\n     * @type {number[]}\n     */\n    const col = []\n\n    for (let pIndex = 0; pIndex < this.vertex.length; pIndex++) {\n      col.push(this.adjoinMatrix.get(this.quantity * pIndex + index))\n    }\n\n    return col\n  }\n\n  /***\n   * 传入一个顶点数组，求出该数组所有顶点的列的合\n   * @param {string[]} ids\n   */\n  getColSum(ids) {\n    const idsVertex = ids.map(id => this.getVertexCol(id))\n    /**\n     * @type {number[]}\n     */\n    const idsVertexSum = []\n\n    for (let i = 0; i < this.vertex.length; i++) {\n      const rowTotal = idsVertex\n        .map(value => value[i])\n        .reduce(function (total, current) {\n          return total + current\n        }, 0)\n\n      idsVertexSum.push(rowTotal)\n    }\n\n    return idsVertexSum\n  }\n\n  /**\n   * 传入一个顶点数组，求出并集\n   * @param {string[]} ids\n   */\n  getCollection(ids) {\n    const idsSum = this.getColSum(ids)\n    /**\n     * @type {string[]}\n     */\n    const collections = []\n\n    idsSum.forEach((sum, index) => {\n      if (sum && this.vertex[index]) collections.push(this.vertex[index])\n    })\n\n    return collections\n  }\n\n  /**\n   * 传入一个顶点数组，求出交集\n   * @param {number[]} ids\n   */\n  getUnions(ids) {\n    const idsSum = this.getColSum(ids)\n    /**\n     * @type {string[]}\n     */\n    const unions = []\n\n    idsSum.forEach((sum, index) => {\n      if (sum >= ids.length && this.vertex[index]) unions.push(this.vertex[index])\n    })\n\n    return unions\n  }\n}\n\nexport class SpecMatrix extends AdjoinMatrix {\n  /**\n   * @param {Product.CommoditySpecs[]} specList\n   * @param {Product.SpecCombination[]} specCombinationList\n   */\n  constructor(specList, specCombinationList) {\n    super(createSpecVertex(specList))\n    /**\n     * @type {Product.CommoditySpecs[]}\n     */\n    this.specList = specList\n    /**\n     * @type {Product.SpecCombination[]}\n     */\n    this.specCombinationList = specCombinationList\n\n    this.init()\n  }\n\n  init() {\n    this.initSpec()\n  }\n\n  initSpec() {\n    const self = this\n    this.specCombinationList.forEach(function (item) {\n      const specs = item.spec.map(spec => spec.value)\n      let prevSpec = specs[0]\n      let i = 0\n\n      while (i < specs.length) {\n        const sides = specs.filter(spec => spec !== prevSpec)\n        self.setAdjoinVertex(prevSpec, sides)\n        i++\n        prevSpec = specs[i]\n      }\n    })\n  }\n\n  /**\n   * @param {string[]} ids\n   */\n  getSpecsOptions(ids) {\n    /**\n     * @type {string[]}\n     */\n    let specOptionCanChoose = null\n\n    if (ids.some(Boolean)) {\n      // 过滤一下选项\n      specOptionCanChoose = this.getUnions(ids.filter(Boolean))\n    } else {\n      // 所有可选项\n      specOptionCanChoose = this.getCollection(this.vertex)\n    }\n\n    return specOptionCanChoose\n  }\n}\n","<template lang=\"pug\">\n  section\n    app-card\n      section.good-container\n        keep-alive\n          el-carousel(:interval=\"5000\" height=\"600px\" arrow=\"always\" key=\"preview\" v-if=\"currentSpec\")\n            el-carousel-item(v-for=\"(spec, k) in detail.specs\" :key=\"k\")\n              el-image(:src=\"spec.img\" fit=\"contain\" alt=\"图片\" style=\"width: 100%; height: 600px\")\n          el-carousel(:interval=\"5000\" height=\"600px\" arrow=\"always\" key=\"album\" v-else)\n            el-carousel-item(v-for=\"(img, k) in detail.album\" :key=\"k\")\n              el-image(:src=\"img\" fit=\"contain\" alt=\"图片\" style=\"width: 100%; height: 600px\")\n\n        div.good-title {{ detail.title }}\n\n        ul.good-spec\n          li.good-spec__item(v-for=\"(item) of detail.specs\" :key=\"item.id\")\n            label.good-spec-title {{ item.attr }}\n            spec-group(v-model=\"item.select\")\n              spec-item(v-for=\"(attr) of item.value\"\n                :disabled=\"optionSpecs.indexOf(attr.label) < 0\"\n                :key=\"attr.id\"\n                :label=\"attr.label\") {{ attr.label }}\n\n        div\n          el-button(type='primary').fluid 购买\n\n    app-card\n      h3 已选择\n      p {{ currentSpec || '-' }}\n</template>\n\n<script>\nimport { goodInfo as detail, specCombinationList } from '@/mock/goods'\nimport { SpecMatrix } from '@/views/product/utils/adjoin-matrix'\n\n/**\n * @param {Good.SpecCombination[]} data\n */\nfunction createSpecCombinationMap(data) {\n  /**\n   * @type {Map<string, Good.SpecCombination>}\n   */\n  const result = new Map()\n\n  data.forEach(function (item) {\n    const key = item.spec.map(item => item.value).join(',')\n    result.set(key, item)\n  })\n\n  return result\n}\n\nexport default {\n  name: 'ProductBuy',\n  props: {\n    id: {\n      type: Number,\n      required: true\n    }\n  },\n  components: {\n    specGroup: () => import('@/views/product/components/spec-group.vue'),\n    specItem: () => import('@/views/product/components/spec-item.vue')\n  },\n  data() {\n    return {\n      detail,\n      specCombinationList,\n      specCombinationMap: createSpecCombinationMap(specCombinationList),\n      specMatrix: new SpecMatrix(detail.specs, specCombinationList)\n    }\n  },\n  computed: {\n    form() {\n      /**\n       * @type {string[]}\n       */\n      const result = []\n\n      this.detail.specs.forEach(function (item) {\n        if (item.select) result.push(item.select)\n      })\n\n      return result\n    },\n    optionSpecs() {\n      return this.specMatrix.getSpecsOptions(this.form)\n    },\n    currentSpec() {\n      if (this.form.length) {\n        const key = this.form.join(',')\n        return this.specCombinationMap.get(key)\n      }\n\n      return null\n    }\n  },\n  mounted() {}\n}\n</script>\n\n<style lang=\"scss\">\n.good-container {\n  display: flex;\n  flex-direction: column;\n  row-gap: 12px;\n  width: 600px;\n  margin: 0 auto;\n}\n\n.good-title {\n  @include ellipsis;\n}\n\n.good-spec {\n  display: flex;\n  flex-direction: column;\n  row-gap: 12px;\n  padding: 0;\n  margin: 0;\n}\n\n.good-spec__item {\n  display: flex;\n}\n\n.good-spec-title {\n  &::after {\n    content: '：';\n  }\n}\n</style>\n"],"file":"static/js/productBuy.7733f17d.js"}