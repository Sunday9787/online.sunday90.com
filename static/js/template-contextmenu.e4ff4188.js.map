{"version":3,"file":"template-contextmenu.e4ff4188.js","sources":["../../../src/views/template/components/template-contextmenu.vue"],"sourcesContent":["<template lang=\"pug\">\nnav.template-contextmenu(:class=\"{ visible }\" :style=\"wrapperStyle\" @pointerdown.stop=\"noop\")\n  template(v-if=\"currentComponent\")\n    a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('del')\") 删除\n    a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('unlock')\" v-if=\"current.lock\") 取消锁定\n    a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('lock')\" v-else) 锁定\n    a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('toTop')\") 置于上层\n    a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('toBottom')\") 置于下层\n  a.template-contextmenu-item(href=\"javascript:;\" @pointerdown=\"command('toPaste')\" v-else) 粘贴\n</template>\n\n<script>\nimport { inject, onBeforeUnmount, onMounted, reactive, ref, computed } from 'vue'\nimport { storeSymbol, templateChannel } from '@/views/template/constant'\nimport { TemplateEvent, shapeLocation } from '@/views/template/utils'\nimport eventBus from '@/utils/eventBus'\n\n/**\n * @type {Record<string, (this: Template.BuiltinComponent) => void>}\n */\nconst commandHandle = {\n  del() {\n    const event = new TemplateEvent(templateChannel.componentDel, {\n      detail: this,\n      target: 'stage'\n    })\n\n    eventBus.$emit(templateChannel.componentDel, event)\n  },\n  lock() {\n    this.props.lock = true\n  },\n  unlock() {\n    this.props.lock = false\n  },\n  toTop() {\n    this.props.zIndex += 1\n  },\n  toBottom() {\n    this.props.zIndex -= 1\n  },\n  toPaste() {}\n}\n\nexport default {\n  name: 'TemplateContextmenu',\n  props: {\n    scale: {\n      type: Number,\n      default: 1\n    }\n  },\n  setup(props) {\n    /**\n     * @type {Vue}\n     */\n    const stageInstance = inject('stageInstance')\n    /**\n     * @type {Template.Store}\n     */\n    const store = inject(storeSymbol)\n    const visible = ref(false)\n    const position = reactive({ x: 0, y: 0 })\n\n    /**\n     * @type {import('vue').Ref<Template.BuiltinComponent>}\n     */\n    const currentComponent = computed(() => store.currentComponent)\n\n    const current = computed(() => {\n      if (currentComponent.value) {\n        return currentComponent.value.props\n      }\n\n      return null\n    })\n\n    /**\n     * @param {PointerEvent} e\n     */\n    const contextmenu = function (e) {\n      e.preventDefault()\n\n      const scale = props.scale / 100\n      const [x, y] = shapeLocation({ x: e.pageX, y: e.pageY, el: stageInstance.$el }, scale)\n\n      position.x = x\n      position.y = y\n      visible.value = true\n    }\n\n    /**\n     * @param {PointerEvent} e\n     */\n    const pointerdown = function (e) {\n      visible.value = false\n    }\n\n    onMounted(function () {\n      stageInstance.$el.addEventListener('contextmenu', contextmenu)\n      window.addEventListener('pointerdown', pointerdown)\n    })\n\n    onBeforeUnmount(function () {\n      stageInstance.$el.removeEventListener('contextmenu', contextmenu)\n      window.removeEventListener('pointerdown', pointerdown)\n    })\n\n    return { visible, position, currentComponent, current }\n  },\n  computed: {\n    wrapperStyle() {\n      return {\n        left: this.position.x + 'px',\n        top: this.position.y + 'px'\n      }\n    }\n  },\n  methods: {\n    /**\n     * @param {'del'|'lock'|'toTop'|'toBottom'|'toPaste'} type\n     */\n    command(type) {\n      commandHandle[type].apply(this.currentComponent)\n      this.visible = false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.template-contextmenu {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 999;\n  width: 98px;\n  padding: 0;\n  margin: 0;\n  visibility: hidden;\n  background-color: #fff;\n  border: 1px solid #e4e7ed;\n  border-radius: 4px;\n  box-shadow: 0 2px 12px 0 rgb(0 0 0 / 10%);\n\n  &.visible {\n    visibility: visible;\n  }\n}\n\n.template-contextmenu-item {\n  display: block;\n  padding: 0 20px;\n  line-height: 34px;\n  @include ellipsis;\n\n  &:hover {\n    background-color: var(--color-primary-light-9);\n  }\n}\n</style>\n"],"names":["commandHandle","del","event","TemplateEvent","templateChannel","componentDel","detail","this","target","eventBus","$emit","lock","props","unlock","toTop","zIndex","toBottom","toPaste","name","scale","type","Number","default","setup","stageInstance","inject","store","storeSymbol","visible","ref","position","reactive","x","y","currentComponent","computed","current","value","contextmenu","e","preventDefault","shapeLocation","pageX","pageY","el","$el","pointerdown","onMounted","addEventListener","window","onBeforeUnmount","removeEventListener","wrapperStyle","left","top","methods","command","apply"],"mappings":"g2CAoBAA,EAAA,CACA,GAAAC,GACA,MAAAC,EAAA,IAAAC,EAAAC,EAAAC,aAAA,CACAC,OAAAC,KACAC,OAAA,UAGAC,EAAAC,MAAAN,EAAAC,aAAAH,EACA,EACA,IAAAS,GACAJ,KAAAK,MAAAD,MAAA,CACA,EACA,MAAAE,GACAN,KAAAK,MAAAD,MAAA,CACA,EACA,KAAAG,GACAP,KAAAK,MAAAG,QAAA,CACA,EACA,QAAAC,GACAT,KAAAK,MAAAG,QAAA,CACA,EACA,OAAAE,GAAA,aAGA,CACAC,KAAA,sBACAN,MAAA,CACAO,MAAA,CACAC,KAAAC,OACAC,QAAA,IAGA,KAAAC,CAAAX,GAIA,MAAAY,EAAAC,EAAA,iBAIAC,EAAAD,EAAAE,GACAC,EAAAC,GAAA,GACAC,EAAAC,EAAA,CAAAC,EAAA,EAAAC,EAAA,IAKAC,EAAAC,GAAA,IAAAT,EAAAQ,mBAEAE,EAAAD,GAAA,IACAD,EAAAG,MACAH,EAAAG,MAAAzB,MAGA,OAMA0B,EAAA,SAAAC,GACAA,EAAAC,iBAEA,MAAArB,EAAAP,EAAAO,MAAA,KACAa,EAAAC,GAAAQ,EAAA,CAAAT,EAAAO,EAAAG,MAAAT,EAAAM,EAAAI,MAAAC,GAAApB,EAAAqB,KAAA1B,GAEAW,EAAAE,EAAAA,EACAF,EAAAG,EAAAA,EACAL,EAAAS,OAAA,CACA,EAKAS,EAAA,SAAAP,GACAX,EAAAS,OAAA,CACA,EAYA,OAVAU,GAAA,WACAvB,EAAAqB,IAAAG,iBAAA,cAAAV,GACAW,OAAAD,iBAAA,cAAAF,EACA,IAEAI,GAAA,WACA1B,EAAAqB,IAAAM,oBAAA,cAAAb,GACAW,OAAAE,oBAAA,cAAAL,EACA,IAEA,CAAAlB,UAAAE,WAAAI,mBAAAE,UACA,EACAD,SAAA,CACA,YAAAiB,GACA,MAAA,CACAC,KAAA9C,KAAAuB,SAAAE,EAAA,KACAsB,IAAA/C,KAAAuB,SAAAG,EAAA,KAEA,GAEAsB,QAAA,CAIA,OAAAC,CAAApC,GACApB,EAAAoB,GAAAqC,MAAAlD,KAAA2B,kBACA3B,KAAAqB,SAAA,CACA"}