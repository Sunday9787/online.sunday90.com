var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{n as i,d as s,o as n}from"./vendor.e75a9f0e.js";import{c as a}from"./index-5.04ee546a.js";import"./libs.ec5fd20d.js";function h(t){return new Promise((function(e,i){const s=new Image;let n;s.onerror=i,s.onload=async function(){n=await window.createImageBitmap(s);const i=new o;i.bitmap=n,i.width=s.width,i.height=s.height,i.url=t,a.set(t,i),s.remove(),e(n)},s.src=t}))}class o{constructor(){e(this,"bitmap",null),e(this,"width",0),e(this,"height",0),e(this,"url","")}static async load(t){for(const e of t)a.has(e)||await h(e)}}class c{constructor(t,i){if(e(this,"width"),e(this,"height"),e(this,"canvas"),e(this,"ctx"),e(this,"stage",new r),this.height=i,this.width=t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),i)return this.canvas.width=t,this.canvas.height=i,this.width=t,void(this.height=i);this.canvas.width=document.documentElement.clientWidth,this.canvas.height=document.documentElement.clientHeight,this.width=document.documentElement.clientWidth,this.height=document.documentElement.clientHeight}init(t){const e=this;t.resizeTo.onresize=function(t){const i=e.canvas.parentElement.clientWidth,s=e.canvas.parentElement.clientHeight;e.canvas.width=i,e.canvas.height=s,e.width=i,e.height=s};const i=function(){e.render(t),e.stage.render(e),window.requestAnimationFrame(i)};window.requestAnimationFrame(i)}render(t){this.ctx.fillStyle=t.background,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.restore()}}class r{constructor(){e(this,"children",[])}add(t){this.children.push(t)}render(t){for(const e of this.children)e.render(t)}}class l{constructor(...t){e(this,"x",0),e(this,"y",0);const[i,s]=l.serialize(...t);this.x=i,this.y=s}static serialize(...t){const[e,i]=t;return i?t:[e,e]}get anchor(){return[this.x,this.y]}set(...t){const[e,i]=l.serialize(...t);this.x=e,this.y=i}}class d{constructor(t){e(this,"texture"),e(this,"anchor",new l(0)),e(this,"x",0),e(this,"y",0),this.texture=t}render(t){t.ctx.drawImage(this.texture.asset.bitmap,this.x-this.texture.width*this.anchor.x,this.y-this.texture.height*this.anchor.y,this.texture.width,this.texture.height)}}class m{constructor(t,i,s){e(this,"width",null),e(this,"height",null),e(this,"asset",null),this.asset=t,this.width=i||t.width,this.height=s||t.height}static from(t){const e=a.get(t);if(e)return new m(e)}}var u=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sem-container"},[e("div",{staticClass:"sem-toolbar"},[e("el-form",{attrs:{size:"small",inline:""}},[e("el-row",[e("el-col",{attrs:{span:12}},[e("el-input",{attrs:{size:"small",type:"text"},model:{value:t.form.img,callback:function(e){t.$set(t.form,"img",e)},expression:"form.img"}})],1),e("el-col",{attrs:{span:12}},[e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.loadImg(t.form.img)}}},[t._v("加载图片")])],1)],1)],1)],1),e("div",{ref:"stageRef",staticClass:"sem-stage flex1"})])},g=[];const w=i({name:"CanvasSem",data:()=>({form:{img:""},canvas:null,ctx:null}),setup(){const t=s(),e=new c;return n((async function(){await o.load(["https://static-1256180570.cos.ap-nanjing.myqcloud.com/image/2023-03-08-18-10-03-pexels-photo-896763.jpeg?imageMogr2/thumbnail/1920x/quality/80"]),t.value.appendChild(e.canvas),e.init({background:"rgb(16,153,187)",resizeTo:window});const i=m.from("https://static-1256180570.cos.ap-nanjing.myqcloud.com/image/2023-03-08-18-10-03-pexels-photo-896763.jpeg?imageMogr2/thumbnail/1920x/quality/80"),s=new d(i);s.anchor.set(.5),s.x=e.width/2,s.y=e.height/2,e.stage.add(s)})),{stageRef:t}},methods:{loadImg(t){const e=this.ctx,i=new Image,s=this.canvas;i.onload=function(){const t=i.height,n=.2*i.width,a=.2*t;e.drawImage(i,s.width/2-n/2,s.height/2-a/2,n,a)},i.src=t}}},u,g,!1,null,null,null,null).exports;export{w as default};
//# sourceMappingURL=index.dede030c.js.map
