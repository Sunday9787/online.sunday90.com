!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,o){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,n||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,t}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r,a,l=[],s=!0,p=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=r.call(n)).done)&&(l.push(o.value),l.length!==t);s=!0);}catch(e){p=!0,i=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(p)throw i}}return l}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){s=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(s)throw a}}}}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}System.register(["./vendor-legacy.ddc66af0.js","./shared/reportTemplate/template-legacy.c0b77459.js","./libs-legacy.774d107d.js","./common-legacy.051f759c.js","./components-legacy.c33fa5cb.js"],(function(e,i){"use strict";var r,a,l,s,p,c,u,m,d,f,b,v,g,y,h,x,C,$,w,z,k,_,S,E,T,M,A,R,D,j,H,L,F,P,O;return{setters:[function(e){r=e.J,a=e.o,l=e.l,s=e.x,p=e.n,c=e.e,u=e.g,m=e.K,d=e.t,f=e.d,b=e._,v=e.w,g=e.i,y=e.L,h=e.M},function(e){x=e.u,C=e.a,$=e.b},function(e){w=e.c,z=e.l},function(e){k=e.t,_=e.T,S=e.d,E=e.r,T=e.e,M=e.i,A=e.j,R=e.l,D=e.m,j=e.s,H=e.n,L=e.q,F=e.v,P=e.w,O=e.x},null],execute:function(){var U=document.createElement("style");function B(e){if(this.restore.push(w(e)),this.record.length){var t=this.record[this.record.length-1].component;if(this.components.has(t.uid)){var n=w(t);n.id=S(t.uid),this.components.set(n.uid,n),this.componentsData=Array.from(this.components.values()),console.log("撤销更改","uid",n.uid,"新id",n.id,"旧id",t.id)}}}function I(e){var t=e.component;if(this.components.has(t.uid)){var n=w(t);n.id=S(t.uid),this.components.set(n.uid,n),this.componentsData=Array.from(this.components.values()),console.log("恢复更改","uid",n.uid,"新id",n.id,"旧id",t.id)}}U.textContent=".template-aside{width:326px}.template-aside-container{margin-top:12px;padding:0 10px;position:relative}.template-aside-title{align-items:center;display:flex;font-size:14px;font-weight:400;height:22px;margin:0}.template-component-group{border:1px solid var(--color-border-light);display:grid;gap:10px;grid-auto-rows:max-content;grid-template-columns:repeat(4,1fr);margin:12px 0 0;overflow:hidden;padding:8px;position:relative}.template-component-item{border:1px solid var(--color-border-light);cursor:grab;font-size:12px;padding:6px;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none}.template-component-item.used{background-color:var(--color-primary-light-7);cursor:not-allowed}.template-component-item:not(.used):active{cursor:grabbing}.template-toolbar{box-shadow:0 0 8px 1px #bfbfbf;display:flex;padding:8px 20px;position:relative;z-index:1}.template-toolbar-padding{color:var(--color-text-regular);-moz-column-gap:10px;column-gap:10px;display:inline-grid;grid-auto-rows:max-content;grid-template-columns:repeat(2,1fr);margin:0 40px 0 0;padding:0;row-gap:10px}.template-toolbar-padding-item{display:flex}.template-toolbar-padding-item,.template-toolbar-padding__inner{-moz-column-gap:5px;column-gap:5px}.template-stage{background-image:url(/static/img/sprite-fe6ccff8.svg);background-repeat:repeat;border:0 solid #f2f2f2;box-shadow:0 0 8px 1px #bfbfbf;outline:none;position:absolute;transform-origin:center}.template-editor{flex:1;overflow:hidden;position:relative}.template-canvas{background-color:var(--color-background-light-gray);height:100%;overflow:hidden;position:relative;width:100%}.template-property{display:flex;flex-direction:column;font-size:12px;padding:0 10px;width:242px}.template-property-action{box-shadow:0 0 4px 1px #bfbfbf;display:flex;flex-direction:column;margin:0 -10px;padding:20px 20px 30px;row-gap:10px}.template-property-container{display:flex;flex-direction:column;row-gap:15px}.template-property-item{align-items:flex-start;-moz-column-gap:10px;column-gap:10px;display:flex}.template-property-grid{display:grid;gap:10px 15px;grid-auto-rows:max-content;grid-template-columns:repeat(2,1fr);margin:0;padding:0}.template-property-list{display:flex;flex-direction:column;margin:0;padding:0;row-gap:10px}.template-property-list-item{align-items:center;-moz-column-gap:10px;column-gap:10px;display:flex}.template-container{background-color:var(--color-background);display:flex;flex-direction:column;height:inherit}.template-main{overflow:hidden;position:relative}\n",document.head.appendChild(U);var q={componentAdd:{undo:function(e){this.restore.push(e),r.$emit(k.componentDel,new _(k.componentDel,{detail:e.component,target:"stage"}),!1)},restore:function(e){r.$emit(k.componentAdd,new _(k.componentAdd,{detail:e.component,target:"stage"}),!1)}},componentDel:{undo:function(e){this.restore.push(e),r.$emit(k.componentAdd,new _(k.componentAdd,{detail:e.component,target:"stage"}),!1)},restore:function(e){r.$emit(k.componentDel,new _(k.componentDel,{detail:e.component,target:"stage"}),!1)}},componentGeneral:{undo:function(e){B.apply(this,[e])},restore:function(e){I.apply(this,[e])}}};function K(e,t){switch(t.type){case"component:add":q.componentAdd[e].apply(this,[t]);break;case"component:del":q.componentDel[e].apply(this,[t]);break;case"component:move:end":case"component:resize:end":case"component:font:change":q.componentGeneral[e].apply(this,[t])}}function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t){var o=function(e,t){var n=Object.create(null);return n.type=e,n.component=w(t),n}(e,t);return console.group("record"),console.info("事件",T[e]),console.info("组件id",t.id),console.info("组件uid",t.uid),console.info("组件props",t.props),console.info("时间戳",z().format("yyyy-MM-DD HH:mm:ss")),console.groupEnd(),void(n&&this.record.length<=20&&this.record.push(o))}console.group("record"),console.info("事件",T[e]),console.info("时间戳",z().format("yyyy-MM-DD HH:mm:ss")),console.groupEnd()}function Y(e,t){return t.forEach((function(t,n){t.id=e+"-"+n})),t}var G=Y("basicBuiltinComponent",[{id:"",label:"病例名称",create:function(){return M({props:{label:this.label}})}},{id:"",label:"产前编号",create:function(){return M({props:{label:this.label}})}},{id:"",label:"姓名",create:function(){return M({props:{label:this.label}})}},{id:"",label:"姓名组",create:function(){return A({builtin:!0,props:{label:this.label,position:R(0,20)}},[M({props:{label:"姓名1"}}),M({props:{label:"姓名2",position:R(20,20)}})])}}]),X=Y("resultsAnalysisBuiltinComponent",[{id:"",label:"核型表达式",create:function(){return M({props:{label:this.label}})}},{id:"",label:"排列图",create:function(){return M({props:{label:this.label}})}},{id:"",label:"中期分裂图",create:function(){return M({props:{label:this.label}})}},{id:"",label:"所有细胞数",create:function(){return M({props:{label:this.label}})}},{id:"",label:"计数细胞数",create:function(){return M({props:{label:this.label}})}},{id:"",label:"排列细胞数",create:function(){return M({props:{label:this.label}})}}]),W=Y("otherBuiltinComponent",[{id:"",label:"机构名称",create:function(){return M({props:{label:this.label}})}},{id:"",label:"样本类型",create:function(){return M({props:{label:this.label}})}},{id:"",label:"采集日期",create:function(){return M({props:{label:this.label}})}},{id:"",label:"接收日期",create:function(){return M({props:{label:this.label}})}},{id:"",label:"检查方法",create:function(){return M({props:{label:this.label}})}},{id:"",label:"报告日期",create:function(){return M({props:{label:this.label}})}},{id:"",label:"审核日期",create:function(){return M({props:{label:this.label}})}},{id:"",label:"接收医师",create:function(){return M({props:{label:this.label}})}},{id:"",label:"审核医师",create:function(){return M({props:{label:this.label}})}}]),J=Y("customBuiltinComponent",[{id:"",label:"输入框",create:function(){return M({props:{label:this.label}})}},{id:"",label:"下拉框",create:function(){return M({props:{label:this.label}})}},{id:"",label:"日期",create:function(){return M({props:{label:this.label}})}},{id:"",label:"电子签名",create:function(){return M({props:{label:this.label}})}},{id:"",label:"文本域",create:function(){return M({props:{label:this.label}})}},{id:"",label:"图片",create:function(){return M({props:{label:this.label}})}},{id:"",label:"矩形",create:function(){return M({props:{label:this.label}})}},{id:"",label:"矩形1",create:function(){return M({props:{label:this.label,size:D({w:120,h:60})}})}},{id:"",label:"矩形2",create:function(){return M({props:{label:this.label,size:D({w:60,h:120})}})}},{id:"",label:"横线",create:function(){return M({props:{label:this.label}})}},{id:"",label:"竖线",create:function(){return M({props:{label:this.label}})}},{id:"",label:"筛选项",create:function(){return M({name:"builtin-select",props:{label:this.label}})}}]),Q=new Map(Array.prototype.concat.apply([],[G,X,W,J]).map((function(e){return[e.id,e]}))),V=[G,W,J];var Z={name:"TemplateAside",setup:function(){var e=function(){var e=[{label:"基本控件",items:[]},{label:"其他控件",items:[]},{label:"自定义控件",items:[]}],t=new Map;V.forEach((function(n,i){var r,a=o(n);try{for(a.s();!(r=a.n()).done;){var l=r.value,p=s({label:l.label,id:l.id,used:!1,offset:{x:0,y:0}});t.set(l.id,p),e[i].items.push(p)}}catch(c){a.e(c)}finally{a.f()}}));var n=function(t){e.forEach((function(e){e.items.forEach((function(e){e.used=!1}))}))},i=function(e){var n=t.get(e.detail.shapeId);n&&(n.used=!0)},p=function(e){var n=t.get(e.detail.shapeId);n&&(n.used=!0)};return a((function(){r.$on(k.componentAdd,i),r.$on(k.componentDel,p),r.$on(k.stageClear,n)})),l((function(){r.$off(k.componentAdd,i),r.$off(k.componentDel,p),r.$off(k.stageClear,n)})),{builtinComponent:e}}();return{builtinComponent:e.builtinComponent}},methods:{dragHandle:function(e){console.log("正在拖拉")},dragstartHandle:function(e,t){console.log("开始拖拽");var n=e.target.getBoundingClientRect();t.offset.x=e.pageX-n.left,t.offset.y=e.pageY-n.top,e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/json",JSON.stringify(t))},dragendHandle:function(e){console.log("结束拖拽"),e.dataTransfer.clearData()}}},ee=p(Z,(function(){var e=this,t=e._self._c;return t("aside",{staticClass:"template-aside"},e._l(e.builtinComponent,(function(n,o){return t("section",{key:o,staticClass:"template-aside-container"},[t("h1",{staticClass:"template-aside-title"},[e._v(e._s(n.label)+"：")]),t("ol",{staticClass:"template-component-group"},e._l(n.items,(function(n){return t("li",{key:n.id,staticClass:"template-component-item",class:{used:n.used},attrs:{draggable:!n.used},on:{dragstart:function(t){return e.dragstartHandle(t,n)},dragend:function(t){return e.dragendHandle(t)},drag:function(t){return e.dragHandle(t)}}},[e._v(e._s(n.label))])})),0)])})),0)}),[],!1,null,null,null,null).exports;var te={name:"TemplateToolbar",setup:function(){var e=u().proxy,t=m(j),n=C(),o=s({name:"",size:"",direction:"",padding:x()}),i=function(e){var t=c({open:"action:visible",close:"action:hidden",submit:"action:submit"}),n=s({visible:!1,editor:!0});return{state:n,actionType:t,action:function(o){var i;switch(o){case t.open:n.visible=!0,null===(i=e.open)||void 0===i||i.apply(null);break;case t.close:n.visible=!1;break;case t.submit:e.submit()}}}}({open:function(){o.name=t.name,o.size=t.size.name,o.direction=t.direction,o.padding=w(t.padding),d((function(){e.$refs.templateName.focus()}))},submit:function(){t.name=o.name,t.direction=o.direction,t.size.name=o.size,t.padding=w(o.padding),a("action:hidden")}}),r=i.state,a=i.action,l=i.actionType;return{store:t,size:n,form:o,dialog:r,action:a,actionType:l}},methods:{goBack:function(){this.$router.go(-1)},stageClear:function(){var e=new _(k.stageClear,{detail:Array.from(this.store.components.values()),target:"toolbar"});r.$emit(k.stageClear,e)},undo:function(){var e=new _(k.stageClear,{detail:null,target:"toolbar"});r.$emit(k.stageUndo,e)},restore:function(){var e=new _(k.stageClear,{detail:null,target:"toolbar"});r.$emit(k.stageRestore,e)}}},ne=p(te,(function(){var e=this,t=e._self._c;return t("header",{staticClass:"template-toolbar"},[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-arrow-left"},on:{click:function(t){return e.goBack()}}},[e._v("返回")]),t("div",{staticClass:"flex1"}),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.undo()}}},[t("i",{staticClass:"el-icon-back"}),e._v(" 撤销")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.restore()}}},[e._v("恢复 "),t("i",{staticClass:"el-icon-right"})]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.stageClear()}}},[e._v("清空画布")]),t("el-button",{attrs:{type:"primary",size:"small"}},[e._v("导入模板")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.action(e.actionType.open)}}},[e._v("模板属性")]),t("el-dialog",{attrs:{visible:e.dialog.visible,"close-on-click-modal":!1,"append-to-body":"",title:"模板属性",width:"500px"},on:{"update:visible":function(t){return e.$set(e.dialog,"visible",t)},closed:function(t){return e.resetForm("formRef")}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.action(e.actionType.submit)}}},[t("el-form",{ref:"formRef",attrs:{model:e.form,action:"javascript:;",size:"medium","label-suffix":"：","label-width":"100px"}},[t("el-form-item",{attrs:{label:"模板名称",prop:"name"}},[t("el-input",{ref:"templateName",model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"尺寸",prop:"size"}},[t("el-radio-group",{model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",t)},expression:"form.size"}},[t("el-radio",{attrs:{label:e.size.A4.name}},[e._v("A4")]),t("el-radio",{attrs:{label:e.size.A5.name}},[e._v("A5")])],1)],1),t("el-form-item",{attrs:{label:"方向",prop:"direction"}},[t("el-radio-group",{model:{value:e.form.direction,callback:function(t){e.$set(e.form,"direction",t)},expression:"form.direction"}},[t("el-radio",{attrs:{label:"vertical"}},[e._v("纵向")]),t("el-radio",{attrs:{label:"horizontal"}},[e._v("横向")])],1)],1),t("el-form-item",{attrs:{label:"页面边距",prop:"padding"}},[t("ol",{staticClass:"template-toolbar-padding"},[t("li",{staticClass:"template-toolbar-padding-item"},[t("label",{attrs:{for:"padding-top"}},[e._v("上：")]),t("el-row",{staticClass:"template-toolbar-padding__inner",attrs:{type:"flex",align:"middle"}},[t("el-input-number",{staticClass:"flex1",attrs:{id:"padding-top",size:"small",min:0,max:40,precision:1,step:1,controls:!1},model:{value:e.form.padding.top,callback:function(t){e.$set(e.form.padding,"top",t)},expression:"form.padding.top"}}),t("span",[e._v("毫米")])],1)],1),t("li",{staticClass:"template-toolbar-padding-item"},[t("label",{attrs:{for:"padding-bottom"}},[e._v("下：")]),t("el-row",{staticClass:"template-toolbar-padding__inner",attrs:{type:"flex",align:"middle"}},[t("el-input-number",{staticClass:"flex1",attrs:{id:"padding-bottom",size:"small",min:0,max:40,precision:1,step:1,controls:!1},model:{value:e.form.padding.bottom,callback:function(t){e.$set(e.form.padding,"bottom",t)},expression:"form.padding.bottom"}}),t("span",[e._v("毫米")])],1)],1),t("li",{staticClass:"template-toolbar-padding-item"},[t("label",{attrs:{for:"padding-left"}},[e._v("左：")]),t("el-row",{staticClass:"template-toolbar-padding__inner",attrs:{type:"flex",align:"middle"}},[t("el-input-number",{staticClass:"flex1",attrs:{id:"padding-left",size:"small",min:0,max:40,precision:1,step:1,controls:!1},model:{value:e.form.padding.left,callback:function(t){e.$set(e.form.padding,"left",t)},expression:"form.padding.left"}}),t("span",[e._v("毫米")])],1)],1),t("li",{staticClass:"template-toolbar-padding-item"},[t("label",{attrs:{for:"padding-right"}},[e._v("右：")]),t("el-row",{staticClass:"template-toolbar-padding__inner",attrs:{type:"flex",align:"middle"}},[t("el-input-number",{staticClass:"flex1",attrs:{id:"padding-right",size:"small",min:0,max:40,precision:1,step:1,controls:!1},model:{value:e.form.padding.right,callback:function(t){e.$set(e.form.padding,"right",t)},expression:"form.padding.right"}}),t("span",[e._v("毫米")])],1)],1)])])],1),t("el-row",{attrs:{slot:"footer",type:"flex",justify:"end"},slot:"footer"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.action(e.actionType.submit)}}},[e._v("确定")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.action(e.actionType.close)}}},[e._v("取消")])],1)],1)],1)}),[],!1,null,null,null,null).exports;function oe(e,t){return Math.abs(e-t)<=5}var ie={yl:function(e,t){var n={visible:oe(e.left,t.left),position:{left:t.left,top:0}},o={visible:oe(e.left,t.right),position:{left:t.right,top:0}};return n.visible?n:o},yc:function(e,t){return{visible:oe(e.right-e.width/2,t.right-t.width/2),position:{left:t.right-t.width/2,top:0}}},yr:function(e,t){var n={visible:oe(e.right,t.right),position:{left:t.right,top:0}},o={visible:oe(e.right,t.left),position:{left:t.left,top:0}};return n.visible?n:o},xt:function(e,t){var n={visible:oe(e.top,t.top),position:{left:0,top:t.top}},o={visible:oe(e.top,t.bottom),position:{left:0,top:t.bottom}};return n.visible?n:o},xc:function(e,t){return{visible:oe(e.bottom-e.height/2,t.bottom-t.height/2),position:{left:0,top:t.bottom-t.height/2}}},xb:function(e,t){var n={visible:oe(e.bottom,t.bottom),position:{left:0,top:t.bottom}},o={visible:oe(e.bottom,t.top),position:{left:0,top:t.top}};return n.visible?n:o}};var re=function(){var e=this,t=e._self._c;return t("div",{staticClass:"template-stage",style:e.stageStyle,attrs:{tabindex:"-1"},on:{pointerdown:e.unSelectComponent,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:e.deleteComponent.apply(null,arguments)},drop:e.dropHandle,dragover:function(t){return t.preventDefault(),e.noop.apply(null,arguments)}}},[t("TemplateContextmenu",{attrs:{scale:e.scale}}),t("TemplateArea",{attrs:{scale:e.scale},on:{area:e.area}}),e._l(e.markLine,(function(e){return t("TemplateMarkLine",{key:e.type,attrs:{position:e.position,direction:e.direction,visible:e.visible}})})),e._l(e.store.componentsData,(function(n){return t("TemplateControl",{key:n.id,attrs:{scale:e.scale,lock:n.props.lock,zIndex:n.props.zIndex,position:n.props.position,size:n.props.size},on:{"update:position":function(t){return e.$set(n.props,"position",t)},"update:size":function(t){return e.$set(n.props,"size",t)},moveStart:function(t){return e.moveStart(n)},move:function(t){return e.move(n)},moveEnd:function(t){return e.moveEnd(n)},resizeStart:function(t){return e.resizeStart(n)},resize:function(t){return e.resize(n)},resizeEnd:function(t){return e.resizeEnd(n)},select:function(t){return e.selectComponent(n)}},model:{value:n.visible,callback:function(t){e.$set(n,"visible",t)},expression:"component.visible"}},["builtin-group"===n.name?t(n.name,e._b({ref:"builtinGroupComponentRef",refInFor:!0,tag:"component",attrs:{top:"",group:"",children:n.children}},"component",n.props,!1)):t(n.name,e._b({ref:"builtinComponentRef",refInFor:!0,tag:"component"},"component",n.props,!1))],1)}))],2)},ae={name:"TemplateStage",components:{BuiltinInput:function(){return b((function(){return i.import("./builtin-input-legacy.14738a71.js")}),void 0)},BuiltinGroup:function(){return b((function(){return i.import("./builtin-group-legacy.b1158dd4.js")}),void 0)},BuiltinSelect:function(){return b((function(){return i.import("./builtin-select-legacy.0ed7b2e1.js")}),void 0)},TemplateControl:function(){return b((function(){return i.import("./template-control-legacy.443a369a.js")}),void 0)},TemplateMarkLine:function(){return b((function(){return i.import("./template-mark-line-legacy.7d4f1866.js")}),void 0)},TemplateArea:function(){return b((function(){return i.import("./template-area-legacy.012f1a6e.js")}),void 0)},TemplateContextmenu:function(){return b((function(){return i.import("./template-contextmenu-legacy.57426272.js")}),void 0)}},props:{scale:{type:Number,required:!0},position:{type:Object,required:!0},spaceDown:{type:Boolean,required:!0},scaleManual:{type:Boolean,required:!1}},provide:function(){return{stageInstance:this}},setup:function(){var e=m(j),t=function(){var e=m(j),t=f([{type:"yl",direction:"vertical",visible:!1,position:{left:0,top:0}},{type:"yc",direction:"vertical",visible:!1,position:{left:0,top:0}},{type:"yr",direction:"vertical",visible:!1,position:{left:0,top:0}},{type:"xt",direction:"horizontal",visible:!1,position:{left:0,top:0}},{type:"xc",direction:"horizontal",visible:!1,position:{left:0,top:0}},{type:"xb",direction:"horizontal",visible:!1,position:{left:0,top:0}}]),i=function(i){var r,a=i.detail,l=H(a),s=o(e.components);try{for(s.s();!(r=s.n()).done;){var p=n(r.value,2),c=p[0],u=p[1];if(c!==a.uid){var m,d=H(u),f=0,b=o(t.value);try{for(b.s();!(m=b.n()).done;){var v=m.value,g=ie[v.type].apply(null,[l,d]),y=g.visible,h=g.position;if(v.visible=y,v.position=h,y){f+=1;var x=h.left||a.props.position.x,C=h.top||a.props.position.y;switch(v.type){case"xt":case"yl":a.props.position.x=x,a.props.position.y=C;break;case"xc":a.props.position.x=x,a.props.position.y=C-a.props.size.h/2;break;case"xb":a.props.position.x=x,a.props.position.y=C-a.props.size.h;break;case"yc":a.props.position.x=x-a.props.size.w/2,a.props.position.y=C;break;case"yr":a.props.position.x=x-a.props.size.w,a.props.position.y=C}}}}catch($){b.e($)}finally{b.f()}if(f)break}}}catch($){s.e($)}finally{s.f()}},s=function(e,n){t.value.forEach((function(e){e.visible=!1}))};return a((function(){r.$on(k.componentMove,i),r.$on(k.componentMoveEnd,s)})),l((function(){r.$off(k.componentMove,i),r.$off(k.componentMoveEnd,s)})),{markLine:t}}();return{store:e,markLine:t.markLine}},computed:{stageStyle:function(){return{borderLeftWidth:this.store.padding.left+"mm",borderTopWidth:this.store.padding.top+"mm",borderRightWidth:this.store.padding.right+"mm",borderBottomWidth:this.store.padding.bottom+"mm",width:this.store.size.width+"px",height:this.store.size.height+"px",left:this.position.x+"px",top:this.position.y+"px",transformOrigin:this.scaleManual?"center":"left top",transform:"scale3d(".concat(this.scale/100,", ").concat(this.scale/100,", 1)")}}},methods:{dropHandle:function(e){var t=e.dataTransfer.getData("application/json"),o=JSON.parse(t),i=Q.get(o.id).create(),a=n(L({x:e.pageX,y:e.pageY,el:this.$el},this.scale/100),2),l=a[0],s=a[1];i.props.position.x=l-o.offset.x,i.props.position.y=s-o.offset.y,i.shapeId=o.id;var p=new _(k.componentAdd,{detail:i,target:"stage"});r.$emit(k.componentAdd,p)},selectComponent:function(e){var t=new _(k.componentSelect,{detail:e,target:"stage"});r.$emit(k.componentSelect,t)},unSelectComponent:function(){if(this.store.currentComponent){if(this.store.currentComponent.children&&!this.store.currentComponent.builtin){var e=new _(k.componentSelectUn,{detail:this.store.currentComponent,target:"stage"});return void r.$emit(k.groupUn,e)}var t=new _(k.componentSelectUn,{detail:null,target:"stage"});r.$emit(k.componentSelectUn,t)}},deleteComponent:function(e){if(this.store.currentComponent){var t=this.store.currentComponent,n=new _(k.componentDel,{detail:t,target:"stage"});r.$emit(k.componentDel,n)}},moveStart:function(e){var t=new _(k.componentMoveStart,{detail:e,target:"stage"});r.$emit(k.componentMoveStart,t)},move:function(e){var t=new _(k.componentMove,{detail:e,target:"stage"});r.$emit(k.componentMove,t)},moveEnd:function(e){var t=new _(k.componentMoveEnd,{detail:e,target:"stage"});r.$emit(k.componentMoveEnd,t)},resizeStart:function(e){var t=new _(k.componentResizeStart,{detail:e,target:"stage"});r.$emit(k.componentResizeStart,t)},resize:function(e){var t=new _(k.componentResize,{detail:e,target:"stage"});r.$emit(k.componentResize,t)},resizeEnd:function(e){var t=new _(k.componentResizeEnd,{detail:e,target:"stage"});r.$emit(k.componentResizeEnd,t)},area:function(e){if(e.length>1){var t=new _(k.groupPack,{detail:e,target:"stage"});r.$emit(k.groupPack,t)}else this.selectComponent(e[0])},toHtml:function(){var e=Array.isArray(this.$refs.builtinGroupComponentRef)?this.$refs.builtinGroupComponentRef:[this.$refs.builtinGroupComponentRef],t=Array.isArray(this.$refs.builtinComponentRef)?this.$refs.builtinComponentRef:[this.$refs.builtinComponentRef],n=this.$el.cloneNode(),o=document.createDocumentFragment(),i=window.getComputedStyle(this.$el);return n.style.left="",n.style.top="",n.style.transform="",n.style.position="relative",n.style.border=i.border,n.style.boxShadow=i.boxShadow,n.style.backgroundImage=i.backgroundImage,n.style.backgroundRepeat=i.backgroundRepeat,e.concat(t).filter(Boolean).forEach((function(e){o.append(e.toHtml())})),n.appendChild(o),n}},watch:{scale:function(e){var t=new _(k.stageScaleChange,{detail:null,target:"stage"});r.$emit(k.stageScaleChange,t)},position:{handler:function(e){var t=new _(k.stageMove,{detail:null,target:"stage"});r.$emit(k.stageMove,t)},deep:!0},"store.size":{handler:function(e){window.dispatchEvent(new Event("resize")),r.$emit(k.stageSizeChange,e)},deep:!0},"store.padding":{handler:function(e){r.$emit(k.stagePaddingChange,e)},deep:!0}}},le=p(ae,re,[],!1,null,null,null,null).exports;var se=function(){var e=this,t=e._self._c;return t("main",{staticClass:"template-editor"},[t("section",{ref:"canvas",staticClass:"template-canvas"},[t("TemplateStage",{ref:"refComponent",attrs:{scale:e.scale.value,position:e.position,spaceDown:e.spaceDown,"scale-manual":e.scale.manual},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"])||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.spaceDownHandle.apply(null,arguments)},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"])||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.spaceUpHandle.apply(null,arguments)}}})],1),t("app-scale",{attrs:{scale:e.scale.value,"max-scale":e.scale.max,"mini-scale":e.scale.mini,step:e.scale.step},on:{"update:scale":function(t){return e.$set(e.scale,"value",t)},change:function(t){return e.scaleManual(!0)}}})],1)},pe=p({name:"TemplateEditor",components:{TemplateStage:le},provide:function(){return{editorInstance:this}},data:function(){return{spaceDown:!1,position:{x:0,y:0},stashPosition:null}},setup:function(){var e=u().proxy,t=m(j),n=function(){var e=f(null),t=function(){var t=e.value.toHtml();t.style.margin="0 auto";var n='\n      <html lang="zh-CN">\n        <head>\n          <meta charset="utf-8" />\n          <title>模板预览</title>\n          <style>\n            * {\n              padding: 0;\n              margin: 0;\n              box-sizing: border-box;\n            }\n          </style>\n        </head>\n        <body style="padding: 20px 0;background-color: #fafafa">\n          '.concat(t.outerHTML,"\n        </body>\n      </html>\n    "),o=new Blob([n],{type:"text/html"}),i=URL.createObjectURL(o);window.open(i,"_blank","width=1024,height=768,scrollbars")};return a((function(){r.$on(k.editorToHtml,t)})),l((function(){r.$off(k.editorToHtml,t)})),{refComponent:e}}(),o=n.refComponent,i=s({step:5,value:100,max:200,mini:20,manual:!1}),p=function(n){e.scaleManual(!1),n.deltaY>0?i.value>i.mini&&(i.value-=i.step):i.value<i.max&&(i.value+=i.step);var r=o.value.$el.getBoundingClientRect(),a=(n.clientX-r.left)/r.width,l=(n.clientY-r.top)/r.height,s=t.size.width*(i.value/100)*a,p=t.size.height*(i.value/100)*l;e.position.x=e.position.x-(s-(n.clientX-r.left)),e.position.y=e.position.y-(p-(n.clientY-r.top))};return a((function(){e.$el.addEventListener("mousewheel",p)})),l((function(){e.$el.removeEventListener("mousewheel",p)})),{scale:i,store:t,refComponent:o}},mounted:function(){var e=this,t=this.refComponent.$el,n=function(t){e.init()},o=function(n){e.spaceDown&&0===n.button&&(e.stashPosition={x:n.clientX-t.offsetLeft,y:n.clientY-t.offsetTop})},i=function(t){e.spaceDown&&e.stashPosition&&(e.position.x=t.clientX-e.stashPosition.x,e.position.y=t.clientY-e.stashPosition.y)},r=function(t){e.stashPosition=null};window.addEventListener("resize",n),window.addEventListener("pointerdown",o),window.addEventListener("pointermove",i),window.addEventListener("pointerup",r),this.$once("hook:beforeDestroy",(function(){window.removeEventListener("resize",n),window.removeEventListener("pointerdown",o),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",r)})),window.dispatchEvent(new Event("resize"))},methods:{init:function(){var e=this.$refs.canvas,t=(e.offsetWidth-this.store.size.width)/2,n=(e.offsetHeight-this.store.size.height)/2;this.position.x=t,this.position.y=n},spaceDownHandle:function(e){var t=e.target;this.spaceDown=!0,t.style.cursor="grab"},spaceUpHandle:function(e){e.target.style.cursor="default",this.spaceDown=!1},scaleManual:function(e){this.scale.manual=e}}},se,[],!1,null,null,null,null).exports,ce="builtin-select",ue=t(t({},"builtin-input",{setting:[{label:"锁定位置",type:"lock",value:!1},{label:"显示下划线",type:"underline",value:!1},{label:"设为虚线",type:"dash",value:!1},{label:"设为必填",type:"required",value:!1}]}),ce,{setting:[{label:"锁定位置",type:"lock",value:!1},{label:"设为必填",type:"required",value:!1}],option:[{label:"选项",type:"option"}]});var me=function(){var e=this,t=e._self._c;return t("aside",{staticClass:"template-property"},[e.currentComponent?t("section",{staticClass:"template-property-container",on:{pointerdown:function(t){return t.stopPropagation(),e.noop.apply(null,arguments)}}},[t("div",{staticClass:"template-property-item"},[t("section",{staticClass:"flex1"},[t("h1",[e._v("字体")]),t("div",{staticClass:"template-property-item"},[t("el-select",{staticClass:"flex1",attrs:{"popper-append-to-body":!1,size:"mini"},on:{change:function(t){return e.componentFontChange(e.currentComponent)}},model:{value:e.current.property.fontFamily.value,callback:function(t){e.$set(e.current.property.fontFamily,"value",t)},expression:"current.property.fontFamily.value"}},e._l(e.fonts,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{staticStyle:{width:"74px"},attrs:{"popper-append-to-body":!1,size:"mini"},on:{change:function(t){return e.componentFontSizeChange(e.currentComponent)}},model:{value:e.current.property.fontSize.value,callback:function(t){e.$set(e.current.property.fontSize,"value",t)},expression:"current.property.fontSize.value"}},e._l(e.fontSizes,(function(e,n){return t("el-option",{key:n,attrs:{label:e.label,value:e.value}})})),1)],1)])]),t("div",{staticClass:"template-property-item"},[t("label",[e._v("控件名称")]),t("span",[e._v(e._s(e.current.label))])]),t("div",{staticClass:"template-property-item"},[t("label",[e._v("位置")]),t("ol",{staticClass:"template-property-grid flex1"},[t("li",{staticClass:"template-property-list-item"},[t("el-input-number",{staticClass:"flex1",attrs:{size:"mini",disabled:e.current.lock,min:0,precision:0,controls:!1},on:{change:function(t){return e.componentMove(e.currentComponent)}},model:{value:e.current.position.x,callback:function(t){e.$set(e.current.position,"x",t)},expression:"current.position.x"}}),t("span",[e._v("X")])],1),t("li",{staticClass:"template-property-list-item"},[t("el-input-number",{staticClass:"flex1",attrs:{size:"mini",disabled:e.current.lock,min:0,precision:0,controls:!1},on:{change:function(t){return e.componentMove(e.currentComponent)}},model:{value:e.current.position.y,callback:function(t){e.$set(e.current.position,"y",t)},expression:"current.position.y"}}),t("span",[e._v("Y")])],1)])]),t("div",{staticClass:"template-property-item"},[t("label",[e._v("大小")]),t("ol",{staticClass:"template-property-grid flex1"},[t("li",{staticClass:"template-property-list-item"},[t("el-input-number",{staticClass:"flex1",attrs:{size:"mini",min:0,precision:0,controls:!1},on:{change:function(t){return e.componentSizeChange(e.currentComponent)}},model:{value:e.current.size.w,callback:function(t){e.$set(e.current.size,"w",t)},expression:"current.size.w"}}),t("span",[e._v("W")])],1),t("li",{staticClass:"template-property-list-item"},[t("el-input-number",{staticClass:"flex1",attrs:{size:"mini",min:0,precision:0,controls:!1},on:{change:function(t){return e.componentSizeChange(e.currentComponent)}},model:{value:e.current.size.h,callback:function(t){e.$set(e.current.size,"h",t)},expression:"current.size.h"}}),t("span",[e._v("H")])],1)])]),e.property?t("div",{staticClass:"template-property-item"},[t("label",[e._v("设置")]),t("ol",{staticClass:"template-property-list flex1"},e._l(e.property.setting,(function(n){return t("li",{key:n.type,staticClass:"template-property-list-item"},["lock"===n.type?t("el-checkbox",{attrs:{label:n.value},model:{value:e.current.lock,callback:function(t){e.$set(e.current,"lock",t)},expression:"current.lock"}},[e._v(e._s(n.label))]):e._e(),"underline"===n.type?t("el-checkbox",{attrs:{label:n.value},model:{value:e.current.property.underline,callback:function(t){e.$set(e.current.property,"underline",t)},expression:"current.property.underline"}},[e._v(e._s(n.label))]):e._e(),"dash"===n.type&&e.current.property.underline?t("el-checkbox",{attrs:{label:n.value},model:{value:e.current.property.dashed,callback:function(t){e.$set(e.current.property,"dashed",t)},expression:"current.property.dashed"}},[e._v(e._s(n.label))]):e._e(),"required"===n.type?t("el-checkbox",{attrs:{label:n.value},model:{value:e.current.required,callback:function(t){e.$set(e.current,"required",t)},expression:"current.required"}},[e._v(e._s(n.label))]):e._e()],1)})),0)]):e._e(),e.property&&e.property.option?t("TemplatePropertyOption",{attrs:{option:e.property.option,current:e.current}}):e._e()],1):e._e(),t("div",{staticClass:"flex1"}),t("section",{staticClass:"template-property-action"},[t("div",[t("el-button",{staticClass:"fluid",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.print()}}},[e._v("打印预览")])],1),t("div",[t("el-button",{staticClass:"fluid",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.save()}}},[e._v("保存并导出")])],1)])])},de=p({name:"TemplateProperty",components:{TemplatePropertyOption:function(){return b((function(){return i.import("./template-property-option-legacy.a1286cdb.js")}),void 0)}},setup:function(){var e,t,n=m(j),o=F().fonts,i=P().fontSizes,r=g((function(){return n.currentComponent})),a=(e=r,t=f(null),e.value&&(t.value=ue[e.value.name]),v((function(){return e.value}),(function(e){t.value=e?ue[e.name]:null})),t),l=g((function(){return r.value?r.value.props:null}));return{currentComponent:r,fonts:o,fontSizes:i,current:l,property:a}},methods:{componentMove:function(e){var t=new _(k.componentMoveEnd,{detail:e,target:"property"});r.$emit(k.componentMoveEnd,t)},componentSizeChange:function(e){var t=new _(k.componentResizeEnd,{detail:e,target:"property"});r.$emit(k.componentResizeEnd,t)},componentFontChange:function(e){var t=new _(k.componentFontChange,{detail:e,target:"property"});r.$emit(k.componentFontChange,t)},componentFontSizeChange:function(e){var t=new _(k.componentFontSizeChange,{detail:e,target:"property"});r.$emit(k.componentFontSizeChange,t)},print:function(){r.$emit(k.editorToHtml)},save:function(){}}},me,[],!1,null,null,null,null).exports,fe=["create","edit"],be={name:"TemplateAction",beforeRouteEnter:function(e,t,n){fe.indexOf(e.query.type)>-1?n():n({path:"/template/action?type=create",replace:!0})},components:{TemplateAside:ee,TemplateToolbar:ne,TemplateEditor:pe,TemplateProperty:de},props:{type:{type:String,required:!0}},setup:function(){var e=$(),t=f(0);y(j,e),function(e){var t=!1,n=!1,o=function(o){switch(o.type){case"component:add":case"component:del":case"component:font:change":N.apply(e,[o.type,o.detail]);break;case"component:resize:start":n=!0;break;case"component:resize":case"component:move:start":N.apply(e,[o.type,o.detail,!1]);break;case"component:resize:end":"property"===o.target?N.apply(e,[o.type,o.detail]):n&&(n=!1,N.apply(e,[o.type,o.detail]));break;case"component:move":t=!0;break;case"component:move:end":"property"===o.target?N.apply(e,[o.type,o.detail]):t&&(t=!1,N.apply(e,[o.type,o.detail]))}};a((function(){r.$on(E.componentAdd,o),r.$on(E.componentDel,o),r.$on(E.componentMoveStart,o),r.$on(E.componentMove,o),r.$on(E.componentMoveEnd,o),r.$on(E.componentFontChange,o),r.$on(E.componentResizeStart,o),r.$on(E.componentResize,o),r.$on(E.componentResizeEnd,o)})),l((function(){r.$off(E.componentAdd,o),r.$off(E.componentDel,o),r.$off(E.componentMoveStart,o),r.$off(E.componentMove,o),r.$off(E.componentMoveEnd,o),r.$off(E.componentFontChange,o),r.$off(E.componentSizeChange,o),r.$off(E.componentResizeStart,o),r.$off(E.componentResize,o),r.$off(E.componentResizeEnd,o)}))}(e);var n=function(n){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=s(n.detail);i.uid=t.value++,i.id=S(i.uid),i.visible=!0,i.children&&i.children.forEach((function(e){e.uid=t.value++,e.id=S(e.uid)})),e.components.set(i.uid,i),e.currentComponent=i,e.changes+=1,o&&r.$emit(E.componentAdd,n)},i=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=t.detail;e.currentComponent=null,e.components.delete(o.uid),e.changes+=1,n&&r.$emit(E.componentDel,t)},p=function(t){e.currentComponent=t.detail,e.currentComponent.visible=!0,r.$emit(E.componentSelect,t)},c=function(t){e.currentComponent=null,r.$emit(E.componentSelectUn,t)},u=function(e){r.$emit(E.componentMoveStart,e)},m=function(e){r.$emit(E.componentMove,e)},d=function(e){r.$emit(E.componentMoveEnd,e)},b=function(e){r.$emit(E.componentResizeStart,e)},v=function(e){r.$emit(E.componentResize,e)},g=function(e){r.$emit(E.componentResizeEnd,e)},x=function(e){r.$emit(E.componentFontChange,e)},C=function(t){e.components.clear(),e.currentComponent=null,r.$emit(E.stageClear,t),e.changes+=1},w=function(t){var n,i=A(t.detail),a=o(i.children);try{for(a.s();!(n=a.n()).done;){var l=n.value;e.components.delete(l.uid)}}catch(p){a.e(p)}finally{a.f()}var s=new _(k.componentAdd,{detail:i,target:"stage"});r.$emit(k.componentAdd,s)},z=function(e){var t,n=o(O(e.detail));try{for(n.s();!(t=n.n()).done;){var i=t.value,a=new _(k.componentAdd,{detail:i,target:"stage"});r.$emit(k.componentAdd,a,!1)}}catch(l){n.e(l)}finally{n.f()}r.$emit(E.groupUn,e),r.$emit(k.componentDel,e,!1)},T=function(){var t=e.record.pop();t&&K.apply(e,["undo",t])},M=function(){var t=e.restore.pop();t&&K.apply(e,["restore",t])};return a((function(){r.$on(k.componentAdd,n),r.$on(k.componentDel,i),r.$on(k.componentSelect,p),r.$on(k.componentSelectUn,c),r.$on(k.componentMoveStart,u),r.$on(k.componentMove,m),r.$on(k.componentMoveEnd,d),r.$on(k.componentResizeStart,b),r.$on(k.componentResize,v),r.$on(k.componentResizeEnd,g),r.$on(k.componentFontChange,x),r.$on(k.groupPack,w),r.$on(k.groupUn,z),r.$on(k.stageClear,C),r.$on(k.stageUndo,T),r.$on(k.stageRestore,M)})),h((function(){r.$off(k.componentAdd,n),r.$off(k.componentDel,i),r.$off(k.componentSelect,p),r.$off(k.componentSelectUn,c),r.$off(k.componentMoveStart,u),r.$off(k.componentMove,m),r.$off(k.componentMoveEnd,d),r.$off(k.componentResizeStart,b),r.$off(k.componentResize,v),r.$off(k.componentResizeEnd,g),r.$off(k.componentFontChange,x),r.$off(k.groupPack,w),r.$off(k.groupUn,z),r.$off(k.stageClear,C),r.$off(k.stageUndo,T),r.$off(k.stageRestore,M)})),{store:e,index:t}}};e("default",p(be,(function(){var e=this._self._c;return e("main",{staticClass:"template-container"},[e("TemplateToolbar"),e("el-container",{staticClass:"template-main"},[e("TemplateAside"),e("TemplateEditor"),e("TemplateProperty")],1)],1)}),[],!1,null,null,null,null).exports)}}}))}();
//# sourceMappingURL=template-legacy.6c91daa4.js.map
